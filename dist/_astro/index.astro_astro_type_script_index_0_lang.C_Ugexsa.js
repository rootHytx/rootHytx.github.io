document.addEventListener("DOMContentLoaded",function(){let h=!0;const d=document.getElementById("terminal-output"),m=document.getElementById("terminal-input");document.querySelector(".directory-listing"),document.querySelector(".directory-path"),document.querySelector(".footer");let f=window.fileSystem||{"github-projects":{bloccChainz:{type:"project",url:"https://github.com/rootHytx/bloccChainz"},github:{type:"project",url:"https://github.com/rootHytx"},"sistemas-embutidos":{type:"project",url:"https://github.com/rootHytx/sistemas-embutidos"},"trabalho-redes":{type:"project",url:"https://github.com/rootHytx/trabalho-redes"}},utilities:{}};if(typeof f=="string")try{f=JSON.parse(f)}catch(t){console.error("Failed to parse fileSystem:",t)}if(f.utilities&&Object.keys(f.utilities).length===0&&window.utilitiesData)try{let t=window.utilitiesData;typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)&&t.forEach(e=>{e&&e.id&&(f.utilities[e.id]={type:"utility",url:e.id})})}catch(t){console.error("Failed to build utilities from utilitiesData:",t)}let g=null,u="~";const k={help:function(){return`
Available commands:
- help: Show this help message
- ls: List files in current directory
- cd [directory]: Navigate to directory
- cat [file]: Read file contents
- clear: Clear the terminal
- pwd: Show current directory
						`},ls:function(){return u==="~"?Object.keys(f).map(t=>t+"/").join(`
`):f[u]?Object.keys(f[u]).join(`
`):""},cd:function(t){if(!t||t===".."||t==="../")return u="~",w(),"";const e=t.replace(/\/$/,"");return f[e]?(u=e,w(),""):`cd: ${t}: No such directory`},cat:function(t){if(!t)return"Usage: cat [filename]";if(u==="github-projects"){const e=f["github-projects"][t];if(e)return window.open(e.url,"_blank"),`Opening ${t}...`}else if(u==="utilities"&&f.utilities[t])return H(t),`Loading ${t}...`;return`cat: ${t}: No such file`},pwd:function(){return u==="~"?"/root":`/root/${u}`},clear:function(){return d&&(d.innerHTML=""),""}};function S(t){if(!d)return;const e=t.trim().split(" "),o=e[0].toLowerCase(),a=e.slice(1);if(k[o]){const s=k[o](...a);s&&(d.innerHTML+='<div class="terminal-line">'+s.replace(/\n/g,"<br>")+"</div>")}else t.trim()&&(d.innerHTML+='<div class="terminal-line">Command not found: '+o+'. Type "help" for available commands.</div>');d.scrollTop=d.scrollHeight}function j(t){if(!m||!d)return t;const e=t.trim().split(/\s+/),o=m.selectionStart??t.length,a=t.substring(0,o),s=a.trim().split(/\s+/).length-1;if(s===0){const n=e[0]||"",r=Object.keys(k).filter(i=>i.startsWith(n.toLowerCase()));if(r.length===1)return r[0]+" ";if(r.length>1){let i=r[0];for(let c=1;c<r.length;c++)for(;!r[c].startsWith(i);)i=i.slice(0,-1);return i.length>n.length?i:(d.innerHTML+='<div class="terminal-line">'+r.join("  ")+"</div>",d.scrollTop=d.scrollHeight,t)}}else{const n=e[0]?.toLowerCase()||"",r=e[s]||"";let i=[];if(n==="cd"?u==="~"?i=Object.keys(f).map(c=>c+"/").filter(c=>c.startsWith(r)):f[u]&&(i=Object.keys(f[u]).filter(c=>c.startsWith(r)),"../".startsWith(r)&&i.push("../")):(n==="cat"||n==="ls")&&(u==="~"?i=Object.keys(f).map(c=>c+"/").filter(c=>c.startsWith(r)):f[u]&&(i=Object.keys(f[u]).filter(c=>c.startsWith(r)))),i.length===1){const c=a.lastIndexOf(r),y=i[0]+(i[0].endsWith("/")?"":" ");return t.substring(0,c)+y+t.substring(o)}else if(i.length>1){let c=i[0];for(let y=1;y<i.length;y++)for(;!i[y].startsWith(c);)c=c.slice(0,-1);if(c.length>r.length){const y=a.lastIndexOf(r);return t.substring(0,y)+c+t.substring(o)}else return d.innerHTML+='<div class="terminal-line">'+i.join("  ")+"</div>",d.scrollTop=d.scrollHeight,t}}return t}function B(){h=!h,h?(m.focus(),m.placeholder="Type commands here..."):(m.blur(),m.placeholder="Press ESC to focus input...")}function w(){const t=document.getElementById("prompt-dir");t&&(t.textContent=u==="~"?"~":u)}async function H(t){let e=(t||"").toString();e.toLowerCase().endsWith(".md")&&(e=e.replace(/\.md$/i,"")),g=e;const o=document.getElementById("directory-view"),a=document.getElementById("utility-view"),s=document.getElementById("utility-content");o.style.display="none",a.classList.add("active");try{let l=window.utilitiesData;if(typeof l=="string")try{l=JSON.parse(l)}catch{}if(l&&typeof l=="object"&&typeof l.serializedUtilitiesData=="string")try{l=JSON.parse(l.serializedUtilitiesData)}catch{}l&&typeof l=="object"&&Array.isArray(l.utilities)&&(l=l.utilities);let n=null;Array.isArray(l)?n=l.find(i=>{if(!i)return!1;const c=(i.id||i.slug||i.data&&i.data.id||"").toString();return c===e||c===t}):l&&typeof l=="object"&&(l[e]?n=l[e]:l[t]?n=l[t]:n=Object.values(l).find(i=>{if(!i)return!1;const c=(i.id||i.slug||i.data&&i.data.id||"").toString();return c===e||c===t}));let r=null;if(n){if(typeof n.content=="string")r=n.content;else if(typeof n.html=="string")r=n.html;else if(typeof n.body=="string")r=n.body;else if(n.render&&typeof n.render=="function")try{const i=n.render();i&&typeof i.html=="string"&&(r=i.html)}catch{}else if(n.data&&typeof n.data.content=="string")r=n.data.content;else if(n.data&&n.data.render&&typeof n.data.render=="function")try{const i=n.data.render();i&&typeof i.html=="string"&&(r=i.html)}catch{}}if(r)s.innerHTML='<div class="utility-content">'+r+"</div>",L(s),p();else try{const i=document.querySelector('.directory-item[data-url="'+e+'"]'),c=document.querySelector('.directory-item[data-url="'+t+'"]');let y=i||c;if(y||(y=Array.from(document.querySelectorAll(".directory-item")).find(A=>{const C=A.querySelector(".project-path");return C&&C.textContent&&C.textContent.includes(e)})),y){const b=y.querySelector(".item-content");b&&b.innerHTML&&b.innerHTML.trim()?(s.innerHTML='<div class="utility-content">'+b.innerHTML+"</div>",L(s),p()):s.innerHTML='<div class="terminal-line">Error: Could not load utility content for '+e+"</div>"}else s.innerHTML='<div class="terminal-line">Error: Could not load utility content for '+e+"</div>"}catch{s.innerHTML='<div class="terminal-line">Error: Could not load utility content for '+e+"</div>"}}catch{s.innerHTML='<div class="terminal-line">Error loading utility: '+e+"</div>"}}function L(t){if(!t)return;Array.from(t.querySelectorAll("pre")).forEach(function(o){if(!(o.parentElement&&o.parentElement.classList.contains("code-block-wrapper"))){var a=document.createElement("div");a.className="code-block-wrapper",o.parentNode.insertBefore(a,o),a.appendChild(o);var s=document.createElement("button");s.className="copy-btn",s.textContent="ðŸ“‹",s.addEventListener("click",function(l){l.stopPropagation();var n=o.querySelector("code"),r=n?n.textContent:o.textContent;navigator.clipboard.writeText(r).then(function(){s.textContent="âœ…",setTimeout(function(){s.textContent="ðŸ“‹"},2e3)})}),a.appendChild(s)}})}function E(){const t=document.getElementById("directory-view"),e=document.getElementById("utility-view");t.style.display="block",e.classList.remove("active"),g=null}m.addEventListener("keydown",function(t){if(t.key==="Enter"){t.preventDefault();const e=m.value;if(e.trim()){const o=u==="~"?"~":u;d.innerHTML+='<div class="terminal-line"><span class="terminal-command">[rootHytx@github.io: '+o+"]$ "+e+"</span></div>",S(e),m.value=""}}else if(t.key==="Tab"){t.preventDefault();const e=j(m.value);e!==m.value&&(m.value=e,m.selectionStart=m.selectionEnd=e.length)}});const v=document.getElementById("keybind-modal");function M(){v&&v.classList.toggle("active")}function D(){return v&&v.classList.contains("active")}document.addEventListener("keydown",function(t){t.key==="?"&&!(h&&document.activeElement===m)&&(t.preventDefault(),M())}),v&&v.addEventListener("click",function(t){t.target===v&&v.classList.remove("active")}),document.addEventListener("keydown",function(t){if(t.key==="Escape"){if(D()){v.classList.remove("active");return}g&&!h?E():B()}}),m.focus(),d.classList.add("active"),d.innerHTML===""&&(d.innerHTML='<div class="terminal-line">'+k.help().replace(/\n/g,"<br>")+"</div>",d.scrollTop=d.scrollHeight);function x(){document.querySelectorAll(".directory-item").forEach(function(e){e.addEventListener("click",function(){const o=this.getAttribute("data-type"),a=this.getAttribute("data-url");if(o==="project"){window.open(a,"_blank");return}if(o==="utility"){const s=this.querySelector(".item-content"),l=document.getElementById("directory-view"),n=document.getElementById("utility-view"),r=document.getElementById("utility-content");s&&s.innerHTML&&s.innerHTML.trim()?(l.style.display="none",n.classList.add("active"),r.innerHTML='<div class="utility-content">'+s.innerHTML+"</div>",L(r),p(),g=a):H(a)}})})}document.getElementById("back-button").addEventListener("click",E);function p(){const t=document.getElementById("utility-view");if(!(!t||!t.classList.contains("active"))){var e=t.querySelectorAll(".code-block-wrapper");if(e.length){var o=t.getBoundingClientRect(),a=o.top+t.clientHeight*.3,s=t.scrollTop+t.clientHeight>=t.scrollHeight-5,l=null;if(s)for(var n=e.length-1;n>=0;n--){var r=e[n].getBoundingClientRect();if(r.bottom>o.top&&r.top<o.bottom){l=e[n];break}}else{for(var n=0;n<e.length;n++){var r=e[n].getBoundingClientRect();if(r.bottom>o.top&&r.top<o.bottom&&r.bottom>a){l=e[n];break}}if(!l)for(var n=e.length-1;n>=0;n--){var r=e[n].getBoundingClientRect();if(r.bottom>o.top&&r.top<o.bottom){l=e[n];break}}}e.forEach(function(i){i.classList.remove("focused")}),l&&l.classList.add("focused")}}}(function(){var t=document.getElementById("utility-view");t&&t.addEventListener("scroll",p)})(),document.addEventListener("keydown",function(t){if(h||D())return;const e=document.getElementById("utility-view");if(e&&e.classList.contains("active")){var o=e.querySelector(".code-block-wrapper.focused pre"),a=40;if(o&&(t.key==="ArrowLeft"||t.key==="h")){t.preventDefault(),o.scrollLeft-=a;return}else if(o&&(t.key==="ArrowRight"||t.key==="l")){t.preventDefault(),o.scrollLeft+=a;return}if(o&&t.key==="y"){t.preventDefault();var s=o.querySelector("code"),l=s?s.textContent:o.textContent,n=o.parentElement.querySelector(".copy-btn");navigator.clipboard.writeText(l).then(function(){n&&(n.textContent="âœ…",n.style.opacity="1",setTimeout(function(){n.textContent="ðŸ“‹",n.style.opacity=""},2e3))});return}if(t.key==="ArrowDown"||t.key==="j"){t.preventDefault(),e.scrollTop+=a,p();return}else if(t.key==="ArrowUp"||t.key==="k"){t.preventDefault(),e.scrollTop-=a,p();return}else if(t.key==="d"&&t.ctrlKey){t.preventDefault(),e.scrollTop+=e.clientHeight*.5,p();return}else if(t.key==="u"&&t.ctrlKey){t.preventDefault(),e.scrollTop-=e.clientHeight*.5,p();return}else if(t.key==="PageDown"){t.preventDefault(),e.scrollTop+=e.clientHeight*.9,p();return}else if(t.key==="PageUp"){t.preventDefault(),e.scrollTop-=e.clientHeight*.9,p();return}else if(t.key==="Home"){t.preventDefault(),e.scrollTop=0,p();return}else if(t.key==="End"||t.key==="G"&&!t.ctrlKey){t.preventDefault(),e.scrollTop=e.scrollHeight,p();return}else if(t.key==="g"&&!t.ctrlKey){t.preventDefault(),e.scrollTop=0,p();return}}const r=document.querySelectorAll(".directory-item");let i=-1;if(r.forEach(function(c,y){c.classList.contains("selected")&&(i=y)}),t.key==="ArrowDown"||t.key==="j"){t.preventDefault();const c=(i+1)%r.length;r.forEach(function(y){y.classList.remove("selected")}),r[c].classList.add("selected")}else if(t.key==="ArrowUp"||t.key==="k"){t.preventDefault();const c=i<=0?r.length-1:i-1;r.forEach(function(y){y.classList.remove("selected")}),r[c].classList.add("selected")}else(t.key==="Enter"||t.key==="l")&&i>=0?r[i].click():t.key==="Backspace"&&g&&E()}),m.focus(),x(),w();const T=document.querySelector(".directory-item");T&&T.classList.add("selected");const I=document.querySelectorAll(".directory-item");I.forEach(function(t){t.addEventListener("mouseenter",function(){I.forEach(function(e){e.classList.remove("selected")}),t.classList.add("selected")})})});
