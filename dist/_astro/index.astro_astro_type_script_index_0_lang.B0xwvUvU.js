document.addEventListener("DOMContentLoaded",function(){let p=!0;const a=document.getElementById("terminal-output"),y=document.getElementById("terminal-input");document.querySelector(".directory-listing"),document.querySelector(".directory-path"),document.querySelector(".footer");let u=window.fileSystem||{"github-projects":{bloccChainz:{type:"project",url:"https://github.com/rootHytx/bloccChainz"},github:{type:"project",url:"https://github.com/rootHytx"},"sistemas-embutidos":{type:"project",url:"https://github.com/rootHytx/sistemas-embutidos"},"trabalho-redes":{type:"project",url:"https://github.com/rootHytx/trabalho-redes"}},utilities:{}};if(typeof u=="string")try{u=JSON.parse(u)}catch(t){console.error("Failed to parse fileSystem:",t)}if(u.utilities&&Object.keys(u.utilities).length===0&&window.utilitiesData)try{let t=window.utilitiesData;typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)&&t.forEach(e=>{e&&e.id&&(u.utilities[e.id]={type:"utility",url:e.id})})}catch(t){console.error("Failed to build utilities from utilitiesData:",t)}let h=null,d="~";const v={help:function(){return`
Available commands:
- help: Show this help message
- ls: List files in current directory
- cd [directory]: Navigate to directory
- cat [file]: Read file contents
- clear: Clear the terminal
- pwd: Show current directory
						`},ls:function(){return d==="~"?Object.keys(u).map(t=>t+"/").join(`
`):u[d]?Object.keys(u[d]).join(`
`):""},cd:function(t){if(!t||t===".."||t==="../")return d="~",b(),"";const e=t.replace(/\/$/,"");return u[e]?(d=e,b(),""):`cd: ${t}: No such directory`},cat:function(t){if(!t)return"Usage: cat [filename]";if(d==="github-projects"){const e=u["github-projects"][t];if(e)return window.open(e.url,"_blank"),`Opening ${t}...`}else if(d==="utilities"&&u.utilities[t])return E(t),`Loading ${t}...`;return`cat: ${t}: No such file`},pwd:function(){return d==="~"?"/root":`/root/${d}`},clear:function(){return a&&(a.innerHTML=""),""}};function D(t){if(!a)return;const e=t.trim().split(" "),s=e[0].toLowerCase(),f=e.slice(1);if(v[s]){const c=v[s](...f);c&&(a.innerHTML+='<div class="terminal-line">'+c.replace(/\n/g,"<br>")+"</div>")}else t.trim()&&(a.innerHTML+='<div class="terminal-line">Command not found: '+s+'. Type "help" for available commands.</div>');a.scrollTop=a.scrollHeight}function I(t){if(!y||!a)return t;const e=t.trim().split(/\s+/),s=y.selectionStart??t.length,f=t.substring(0,s),c=f.trim().split(/\s+/).length-1;if(c===0){const o=e[0]||"",l=Object.keys(v).filter(i=>i.startsWith(o.toLowerCase()));if(l.length===1)return l[0]+" ";if(l.length>1){let i=l[0];for(let r=1;r<l.length;r++)for(;!l[r].startsWith(i);)i=i.slice(0,-1);return i.length>o.length?i:(a.innerHTML+='<div class="terminal-line">'+l.join("  ")+"</div>",a.scrollTop=a.scrollHeight,t)}}else{const o=e[0]?.toLowerCase()||"",l=e[c]||"";let i=[];if(o==="cd"?d==="~"?i=Object.keys(u).map(r=>r+"/").filter(r=>r.startsWith(l)):u[d]&&(i=Object.keys(u[d]).filter(r=>r.startsWith(l)),"../".startsWith(l)&&i.push("../")):(o==="cat"||o==="ls")&&(d==="~"?i=Object.keys(u).map(r=>r+"/").filter(r=>r.startsWith(l)):u[d]&&(i=Object.keys(u[d]).filter(r=>r.startsWith(l)))),i.length===1){const r=f.lastIndexOf(l),m=i[0]+(i[0].endsWith("/")?"":" ");return t.substring(0,r)+m+t.substring(s)}else if(i.length>1){let r=i[0];for(let m=1;m<i.length;m++)for(;!i[m].startsWith(r);)r=r.slice(0,-1);if(r.length>l.length){const m=f.lastIndexOf(l);return t.substring(0,m)+r+t.substring(s)}else return a.innerHTML+='<div class="terminal-line">'+i.join("  ")+"</div>",a.scrollTop=a.scrollHeight,t}}return t}function S(){p=!p,p?(y.focus(),y.placeholder="Type commands here..."):(y.blur(),y.placeholder="Press ESC to focus input...")}function b(){const t=document.getElementById("prompt-dir");t&&(t.textContent=d==="~"?"~":d)}async function E(t){let e=(t||"").toString();e.toLowerCase().endsWith(".md")&&(e=e.replace(/\.md$/i,"")),h=e;const s=document.getElementById("directory-view"),f=document.getElementById("utility-view"),c=document.getElementById("utility-content");s.style.display="none",f.classList.add("active");try{let n=window.utilitiesData;if(typeof n=="string")try{n=JSON.parse(n)}catch{}if(n&&typeof n=="object"&&typeof n.serializedUtilitiesData=="string")try{n=JSON.parse(n.serializedUtilitiesData)}catch{}n&&typeof n=="object"&&Array.isArray(n.utilities)&&(n=n.utilities);let o=null;Array.isArray(n)?o=n.find(i=>{if(!i)return!1;const r=(i.id||i.slug||i.data&&i.data.id||"").toString();return r===e||r===t}):n&&typeof n=="object"&&(n[e]?o=n[e]:n[t]?o=n[t]:o=Object.values(n).find(i=>{if(!i)return!1;const r=(i.id||i.slug||i.data&&i.data.id||"").toString();return r===e||r===t}));let l=null;if(o){if(typeof o.content=="string")l=o.content;else if(typeof o.html=="string")l=o.html;else if(typeof o.body=="string")l=o.body;else if(o.render&&typeof o.render=="function")try{const i=o.render();i&&typeof i.html=="string"&&(l=i.html)}catch{}else if(o.data&&typeof o.data.content=="string")l=o.data.content;else if(o.data&&o.data.render&&typeof o.data.render=="function")try{const i=o.data.render();i&&typeof i.html=="string"&&(l=i.html)}catch{}}if(l)c.innerHTML='<div class="utility-content">'+l+"</div>";else try{const i=document.querySelector('.directory-item[data-url="'+e+'"]'),r=document.querySelector('.directory-item[data-url="'+t+'"]');let m=i||r;if(m||(m=Array.from(document.querySelectorAll(".directory-item")).find(j=>{const L=j.querySelector(".project-path");return L&&L.textContent&&L.textContent.includes(e)})),m){const g=m.querySelector(".item-content");g&&g.innerHTML&&g.innerHTML.trim()?c.innerHTML='<div class="utility-content">'+g.innerHTML+"</div>":c.innerHTML='<div class="terminal-line">Error: Could not load utility content for '+e+"</div>"}else c.innerHTML='<div class="terminal-line">Error: Could not load utility content for '+e+"</div>"}catch{c.innerHTML='<div class="terminal-line">Error: Could not load utility content for '+e+"</div>"}}catch{c.innerHTML='<div class="terminal-line">Error loading utility: '+e+"</div>"}}function w(){const t=document.getElementById("directory-view"),e=document.getElementById("utility-view");t.style.display="block",e.classList.remove("active"),h=null}y.addEventListener("keydown",function(t){if(t.key==="Enter"){t.preventDefault();const e=y.value;if(e.trim()){const s=d==="~"?"~":d;a.innerHTML+='<div class="terminal-line"><span class="terminal-command">[rootHytx@github.io: '+s+"]$ "+e+"</span></div>",D(e),y.value=""}}else if(t.key==="Tab"){t.preventDefault();const e=I(y.value);e!==y.value&&(y.value=e,y.selectionStart=y.selectionEnd=e.length)}}),document.addEventListener("keydown",function(t){t.key==="Escape"&&(h&&!p?w():S())}),y.focus(),a.classList.add("active"),a.innerHTML===""&&(a.innerHTML='<div class="terminal-line">'+v.help().replace(/\n/g,"<br>")+"</div>",a.scrollTop=a.scrollHeight);function T(){document.querySelectorAll(".directory-item").forEach(function(e){e.addEventListener("click",function(){const s=this.getAttribute("data-type"),f=this.getAttribute("data-url");if(s==="project"){window.open(f,"_blank");return}if(s==="utility"){const c=this.querySelector(".item-content"),n=document.getElementById("directory-view"),o=document.getElementById("utility-view"),l=document.getElementById("utility-content");c&&c.innerHTML&&c.innerHTML.trim()?(n.style.display="none",o.classList.add("active"),l.innerHTML='<div class="utility-content">'+c.innerHTML+"</div>",h=f):E(f)}})})}document.getElementById("back-button").addEventListener("click",w),document.addEventListener("keydown",function(t){if(p)return;const e=document.getElementById("utility-view");if(e&&e.classList.contains("active")){if(t.key==="ArrowDown"){t.preventDefault(),e.scrollTop+=40;return}else if(t.key==="ArrowUp"){t.preventDefault(),e.scrollTop-=40;return}else if(t.key==="PageDown"){t.preventDefault(),e.scrollTop+=e.clientHeight*.9;return}else if(t.key==="PageUp"){t.preventDefault(),e.scrollTop-=e.clientHeight*.9;return}else if(t.key==="Home"){t.preventDefault(),e.scrollTop=0;return}else if(t.key==="End"){t.preventDefault(),e.scrollTop=e.scrollHeight;return}}const s=document.querySelectorAll(".directory-item");let f=-1;if(s.forEach(function(c,n){c.classList.contains("selected")&&(f=n)}),t.key==="ArrowDown"){t.preventDefault();const c=(f+1)%s.length;s.forEach(function(n){n.classList.remove("selected")}),s[c].classList.add("selected")}else if(t.key==="ArrowUp"){t.preventDefault();const c=f<=0?s.length-1:f-1;s.forEach(function(n){n.classList.remove("selected")}),s[c].classList.add("selected")}else t.key==="Enter"&&f>=0?s[f].click():t.key==="Backspace"&&h&&w()}),y.focus(),T(),b();const H=document.querySelector(".directory-item");H&&H.classList.add("selected");const k=document.querySelectorAll(".directory-item");k.forEach(function(t){t.addEventListener("mouseenter",function(){k.forEach(function(e){e.classList.remove("selected")}),t.classList.add("selected")})})});
