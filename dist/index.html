<!DOCTYPE html><html lang="en" data-astro-cid-j7pv25f6> <head><meta charset="utf-8"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>root/hytx</title><link rel="stylesheet" href="/_astro/index.DQfjLd-h.css"></head> <body data-astro-cid-j7pv25f6> <div class="content" data-astro-cid-j7pv25f6> <div class="header" data-astro-cid-j7pv25f6> <span class="username" data-astro-cid-j7pv25f6>root/hytx</span> <span class="cursor" data-astro-cid-j7pv25f6></span> </div> <div class="content-area" data-astro-cid-j7pv25f6> <div id="directory-view" data-astro-cid-j7pv25f6> <div class="directory-path" data-astro-cid-j7pv25f6>/root/github-projects</div> <div class="directory-listing" data-astro-cid-j7pv25f6> <div class="directory-item" data-type="project" data-url="https://github.com/rootHytx/sistemas-embutidos" data-content-length="0" data-astro-cid-j7pv25f6> <span class="folder-icon" data-astro-cid-j7pv25f6>└─</span> <span class="project-path" data-astro-cid-j7pv25f6>/root/github-projects/sistemas-embutidos</span> </div> <div class="directory-item" data-type="project" data-url="https://github.com/rootHytx/bloccChainz" data-content-length="0" data-astro-cid-j7pv25f6> <span class="folder-icon" data-astro-cid-j7pv25f6>└─</span> <span class="project-path" data-astro-cid-j7pv25f6>/root/github-projects/bloccChainz</span> </div> <div class="directory-item" data-type="project" data-url="https://github.com/rootHytx/trabalho-redes" data-content-length="0" data-astro-cid-j7pv25f6> <span class="folder-icon" data-astro-cid-j7pv25f6>└─</span> <span class="project-path" data-astro-cid-j7pv25f6>/root/github-projects/trabalho-redes</span> </div> <div class="directory-item" data-type="project" data-url="https://github.com/rootHytx" data-content-length="0" data-astro-cid-j7pv25f6> <span class="folder-icon" data-astro-cid-j7pv25f6>└─</span> <span class="project-path" data-astro-cid-j7pv25f6>/root/github-projects/github</span> </div> </div> <div class="directory-path" style="margin-top: 30px;" data-astro-cid-j7pv25f6>/root/utilities</div> <div class="directory-item" data-type="utility" data-url="certificate-generation" data-content-length="10923" data-astro-cid-j7pv25f6> <span class="folder-icon" data-astro-cid-j7pv25f6>└─</span> <span class="project-path" data-astro-cid-j7pv25f6>/root/utilities/certificate-generation</span> <!-- Hidden inline copy of the rendered markdown HTML (server-rendered). Inject raw HTML with set:html --> <div class="item-content" style="display:none;" data-astro-cid-j7pv25f6><h1 id="ssl-certificate-generation">SSL Certificate Generation</h1>
<p>Generate SSL certificates using Certbot with DNS challenge validation. This method is ideal for automated certificate generation and wildcard certificates.</p>
<h2 id="docker-certbot-command">Docker Certbot Command</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> run</span><span style="color:#79B8FF"> -it</span><span style="color:#79B8FF"> --rm</span><span style="color:#79B8FF"> --name</span><span style="color:#9ECBFF"> certbot</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -v</span><span style="color:#9ECBFF"> "./certs:/etc/letsencrypt"</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#9ECBFF">  certbot/certbot</span><span style="color:#9ECBFF"> certonly</span><span style="color:#79B8FF"> --manual</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  --preferred-challenges</span><span style="color:#9ECBFF"> dns</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -d</span><span style="color:#9ECBFF"> DOMAIN</span></span></code></pre>
<h2 id="manual-dns-challenge-steps">Manual DNS Challenge Steps</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># 1. Run the Docker command above</span></span>
<span class="line"><span style="color:#6A737D"># 2. Certbot will prompt you to create DNS TXT records</span></span>
<span class="line"><span style="color:#6A737D"># 3. Add the TXT records to your DNS provider</span></span>
<span class="line"><span style="color:#6A737D"># 4. Wait for DNS propagation (usually 1-5 minutes)</span></span>
<span class="line"><span style="color:#6A737D"># 5. Press Enter to continue validation</span></span>
<span class="line"><span style="color:#6A737D"># 6. Certificates will be saved in ./certs/</span></span></code></pre>
<h2 id="example-usage">Example Usage</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Generate certificate for example.com</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> run</span><span style="color:#79B8FF"> -it</span><span style="color:#79B8FF"> --rm</span><span style="color:#79B8FF"> --name</span><span style="color:#9ECBFF"> certbot</span><span style="color:#79B8FF"> -v</span><span style="color:#9ECBFF"> "./certs:/etc/letsencrypt"</span><span style="color:#9ECBFF"> certbot/certbot</span><span style="color:#9ECBFF"> certonly</span><span style="color:#79B8FF"> --manual</span><span style="color:#79B8FF"> --preferred-challenges</span><span style="color:#9ECBFF"> dns</span><span style="color:#79B8FF"> -d</span><span style="color:#9ECBFF"> example.com</span><span style="color:#79B8FF"> -d</span><span style="color:#79B8FF"> *</span><span style="color:#9ECBFF">.example.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Generate wildcard certificate</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> run</span><span style="color:#79B8FF"> -it</span><span style="color:#79B8FF"> --rm</span><span style="color:#79B8FF"> --name</span><span style="color:#9ECBFF"> certbot</span><span style="color:#79B8FF"> -v</span><span style="color:#9ECBFF"> "./certs:/etc/letsencrypt"</span><span style="color:#9ECBFF"> certbot/certbot</span><span style="color:#9ECBFF"> certonly</span><span style="color:#79B8FF"> --manual</span><span style="color:#79B8FF"> --preferred-challenges</span><span style="color:#9ECBFF"> dns</span><span style="color:#79B8FF"> -d</span><span style="color:#9ECBFF"> "*.example.com"</span></span></code></pre>
<h2 id="certificate-locations">Certificate Locations</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Generated certificates will be in:</span></span>
<span class="line"><span style="color:#B392F0">./certs/live/DOMAIN/fullchain.pem</span></span>
<span class="line"><span style="color:#B392F0">./certs/live/DOMAIN/privkey.pem</span></span>
<span class="line"><span style="color:#B392F0">./certs/live/DOMAIN/cert.pem</span></span>
<span class="line"><span style="color:#B392F0">./certs/live/DOMAIN/chain.pem</span></span></code></pre>
<h2 id="automation-tips">Automation Tips</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Use DNS provider APIs for automated validation</span></span>
<span class="line"><span style="color:#6A737D"># Set up cron jobs for automatic renewal</span></span>
<span class="line"><span style="color:#6A737D"># Use --dry-run to test without generating real certificates</span></span>
<span class="line"><span style="color:#6A737D"># Combine with Docker Compose for easier management</span></span></code></pre>
<h2 id="dns-provider-integration">DNS Provider Integration</h2>
<h3 id="cloudflare">Cloudflare</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Use Cloudflare API token with DNS challenge</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> run</span><span style="color:#79B8FF"> -it</span><span style="color:#79B8FF"> --rm</span><span style="color:#79B8FF"> --name</span><span style="color:#9ECBFF"> certbot</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -v</span><span style="color:#9ECBFF"> "./certs:/etc/letsencrypt"</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -e</span><span style="color:#9ECBFF"> CLOUDFLARE_API_TOKEN=your_token</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#9ECBFF">  certbot/dns-cloudflare</span><span style="color:#9ECBFF"> certonly</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  --dns-cloudflare</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -d</span><span style="color:#9ECBFF"> example.com</span><span style="color:#79B8FF"> -d</span><span style="color:#79B8FF"> *</span><span style="color:#9ECBFF">.example.com</span></span></code></pre>
<h3 id="route53">Route53</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Use AWS credentials for Route53</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> run</span><span style="color:#79B8FF"> -it</span><span style="color:#79B8FF"> --rm</span><span style="color:#79B8FF"> --name</span><span style="color:#9ECBFF"> certbot</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -v</span><span style="color:#9ECBFF"> "./certs:/etc/letsencrypt"</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -e</span><span style="color:#9ECBFF"> AWS_ACCESS_KEY_ID=your_key</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -e</span><span style="color:#9ECBFF"> AWS_SECRET_ACCESS_KEY=your_secret</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#9ECBFF">  certbot/dns-route53</span><span style="color:#9ECBFF"> certonly</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  --dns-route53</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -d</span><span style="color:#9ECBFF"> example.com</span></span></code></pre>
<h2 id="renewal-commands">Renewal Commands</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Test renewal (dry run)</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> run</span><span style="color:#79B8FF"> -it</span><span style="color:#79B8FF"> --rm</span><span style="color:#79B8FF"> --name</span><span style="color:#9ECBFF"> certbot</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -v</span><span style="color:#9ECBFF"> "./certs:/etc/letsencrypt"</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#9ECBFF">  certbot/certbot</span><span style="color:#9ECBFF"> renew</span><span style="color:#79B8FF"> --dry-run</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Actual renewal</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> run</span><span style="color:#79B8FF"> -it</span><span style="color:#79B8FF"> --rm</span><span style="color:#79B8FF"> --name</span><span style="color:#9ECBFF"> certbot</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  -v</span><span style="color:#9ECBFF"> "./certs:/etc/letsencrypt"</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#9ECBFF">  certbot/certbot</span><span style="color:#9ECBFF"> renew</span></span></code></pre>
<h2 id="certificate-types">Certificate Types</h2>
<ul>
<li><strong>Single Domain</strong>: Certificate for one specific domain</li>
<li><strong>Multiple Domains</strong>: Certificate covering multiple domains</li>
<li><strong>Wildcard</strong>: Certificate for all subdomains (*.example.com)</li>
<li><strong>SAN (Subject Alternative Name)</strong>: Certificate with multiple domain names</li>
</ul>
<h2 id="best-practices">Best Practices</h2>
<ul>
<li>Use wildcard certificates for subdomains</li>
<li>Set up automatic renewal (certificates expire every 90 days)</li>
<li>Test with —dry-run before production use</li>
<li>Store certificates securely with proper permissions</li>
<li>Use environment variables for sensitive data</li>
<li>Monitor certificate expiration dates</li>
</ul></div> </div><div class="directory-item" data-type="utility" data-url="docker-install" data-content-length="14456" data-astro-cid-j7pv25f6> <span class="folder-icon" data-astro-cid-j7pv25f6>└─</span> <span class="project-path" data-astro-cid-j7pv25f6>/root/utilities/docker-install</span> <!-- Hidden inline copy of the rendered markdown HTML (server-rendered). Inject raw HTML with set:html --> <div class="item-content" style="display:none;" data-astro-cid-j7pv25f6><h1 id="docker-installation-script">Docker Installation Script</h1>
<p>Complete Docker installation script for Ubuntu systems. This script installs the latest Docker Engine from Docker’s official repositories.</p>
<h2 id="installation-script">Installation Script</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Remove old Docker versions</span></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> pkg </span><span style="color:#F97583">in</span><span style="color:#9ECBFF"> docker.io</span><span style="color:#9ECBFF"> docker-doc</span><span style="color:#9ECBFF"> docker-compose</span><span style="color:#9ECBFF"> docker-compose-v2</span><span style="color:#9ECBFF"> podman-docker</span><span style="color:#9ECBFF"> containerd</span><span style="color:#9ECBFF"> runc</span><span style="color:#E1E4E8">; </span><span style="color:#F97583">do</span></span>
<span class="line"><span style="color:#B392F0">  sudo</span><span style="color:#9ECBFF"> apt-get</span><span style="color:#9ECBFF"> remove</span><span style="color:#E1E4E8"> $pkg</span></span>
<span class="line"><span style="color:#F97583">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Add Docker's official GPG key:</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> apt-get</span><span style="color:#9ECBFF"> update</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> apt-get</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> ca-certificates</span><span style="color:#9ECBFF"> curl</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> install</span><span style="color:#79B8FF"> -m</span><span style="color:#79B8FF"> 0755</span><span style="color:#79B8FF"> -d</span><span style="color:#9ECBFF"> /etc/apt/keyrings</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> curl</span><span style="color:#79B8FF"> -fsSL</span><span style="color:#9ECBFF"> https://download.docker.com/linux/ubuntu/gpg</span><span style="color:#79B8FF"> -o</span><span style="color:#9ECBFF"> /etc/apt/keyrings/docker.asc</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> chmod</span><span style="color:#9ECBFF"> a+r</span><span style="color:#9ECBFF"> /etc/apt/keyrings/docker.asc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Add the repository to Apt sources:</span></span>
<span class="line"><span style="color:#79B8FF">echo</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#9ECBFF">  "deb [arch=$(</span><span style="color:#B392F0">dpkg</span><span style="color:#79B8FF"> --print-architecture</span><span style="color:#9ECBFF">) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu </span><span style="color:#79B8FF">\</span></span>
<span class="line"><span style="color:#9ECBFF">  $(</span><span style="color:#79B8FF">.</span><span style="color:#9ECBFF"> /etc/os-release &#x26;&#x26; </span><span style="color:#79B8FF">echo</span><span style="color:#9ECBFF"> "${</span><span style="color:#E1E4E8">UBUNTU_CODENAME</span><span style="color:#F97583">:-</span><span style="color:#E1E4E8">$VERSION_CODENAME</span><span style="color:#9ECBFF">}") stable"</span><span style="color:#F97583"> |</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#B392F0">  sudo</span><span style="color:#9ECBFF"> tee</span><span style="color:#9ECBFF"> /etc/apt/sources.list.d/docker.list</span><span style="color:#F97583"> ></span><span style="color:#9ECBFF"> /dev/null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Install Docker Engine</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> apt-get</span><span style="color:#9ECBFF"> update</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> apt-get</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> docker-ce</span><span style="color:#9ECBFF"> docker-ce-cli</span><span style="color:#9ECBFF"> containerd.io</span><span style="color:#9ECBFF"> docker-buildx-plugin</span><span style="color:#9ECBFF"> docker-compose-plugin</span></span></code></pre>
<h2 id="post-installation-steps">Post-Installation Steps</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Add your user to the docker group</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> usermod</span><span style="color:#79B8FF"> -aG</span><span style="color:#9ECBFF"> docker</span><span style="color:#E1E4E8"> $USER</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Activate group changes (log out and back in, or run:)</span></span>
<span class="line"><span style="color:#B392F0">newgrp</span><span style="color:#9ECBFF"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Verify installation</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#79B8FF"> --version</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> compose</span><span style="color:#9ECBFF"> version</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Test Docker</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> run</span><span style="color:#9ECBFF"> hello-world</span></span></code></pre>
<h2 id="usage-notes">Usage Notes</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Save the script as install-docker.sh</span></span>
<span class="line"><span style="color:#B392F0">chmod</span><span style="color:#9ECBFF"> +x</span><span style="color:#9ECBFF"> install-docker.sh</span></span>
<span class="line"><span style="color:#B392F0">./install-docker.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Or run directly:</span></span>
<span class="line"><span style="color:#B392F0">curl</span><span style="color:#79B8FF"> -fsSL</span><span style="color:#9ECBFF"> https://get.docker.com</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Warning: The script removes existing Docker installations</span></span>
<span class="line"><span style="color:#6A737D"># Make sure to backup any important containers/data</span></span></code></pre>
<h2 id="alternative-one-line-install">Alternative: One-Line Install</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Use Docker's official install script:</span></span>
<span class="line"><span style="color:#B392F0">curl</span><span style="color:#79B8FF"> -fsSL</span><span style="color:#9ECBFF"> https://get.docker.com</span><span style="color:#79B8FF"> -o</span><span style="color:#9ECBFF"> get-docker.sh</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> sh</span><span style="color:#9ECBFF"> get-docker.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Or direct pipe:</span></span>
<span class="line"><span style="color:#B392F0">curl</span><span style="color:#79B8FF"> -fsSL</span><span style="color:#9ECBFF"> https://get.docker.com</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> sh</span></span></code></pre>
<h2 id="uninstall-docker">Uninstall Docker</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Remove Docker packages</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> apt-get</span><span style="color:#9ECBFF"> purge</span><span style="color:#9ECBFF"> docker-ce</span><span style="color:#9ECBFF"> docker-ce-cli</span><span style="color:#9ECBFF"> containerd.io</span><span style="color:#9ECBFF"> docker-buildx-plugin</span><span style="color:#9ECBFF"> docker-compose-plugin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Remove images, containers, and volumes</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> rm</span><span style="color:#79B8FF"> -rf</span><span style="color:#9ECBFF"> /var/lib/docker</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> rm</span><span style="color:#79B8FF"> -rf</span><span style="color:#9ECBFF"> /var/lib/containerd</span></span></code></pre>
<h2 id="docker-compose-setup">Docker Compose Setup</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Install Docker Compose (if not included)</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> apt-get</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> docker-compose-plugin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Verify Docker Compose</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> compose</span><span style="color:#9ECBFF"> version</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Create docker-compose.yml file</span></span>
<span class="line"><span style="color:#B392F0">cat</span><span style="color:#F97583"> ></span><span style="color:#9ECBFF"> docker-compose.yml</span><span style="color:#F97583"> &#x3C;&#x3C;</span><span style="color:#9ECBFF"> 'EOF'</span></span>
<span class="line"><span style="color:#9ECBFF">version: '3.8'</span></span>
<span class="line"><span style="color:#9ECBFF">services:</span></span>
<span class="line"><span style="color:#9ECBFF">  web:</span></span>
<span class="line"><span style="color:#9ECBFF">    image: nginx:alpine</span></span>
<span class="line"><span style="color:#9ECBFF">    ports:</span></span>
<span class="line"><span style="color:#9ECBFF">      - "80:80"</span></span>
<span class="line"><span style="color:#9ECBFF">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Run with Docker Compose</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> compose</span><span style="color:#9ECBFF"> up</span><span style="color:#79B8FF"> -d</span></span></code></pre>
<h2 id="common-issues">Common Issues</h2>
<h3 id="permission-denied">Permission Denied</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># If you get "Got permission denied" error:</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> usermod</span><span style="color:#79B8FF"> -aG</span><span style="color:#9ECBFF"> docker</span><span style="color:#E1E4E8"> $USER</span></span>
<span class="line"><span style="color:#B392F0">newgrp</span><span style="color:#9ECBFF"> docker</span></span></code></pre>
<h3 id="port-already-in-use">Port Already in Use</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Check what's using the port</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> netstat</span><span style="color:#79B8FF"> -tulpn</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> grep</span><span style="color:#9ECBFF"> :80</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Or use lsof</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> lsof</span><span style="color:#79B8FF"> -i</span><span style="color:#9ECBFF"> :80</span></span></code></pre>
<h3 id="docker-daemon-not-running">Docker Daemon Not Running</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Start Docker service</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> systemctl</span><span style="color:#9ECBFF"> start</span><span style="color:#9ECBFF"> docker</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> systemctl</span><span style="color:#9ECBFF"> enable</span><span style="color:#9ECBFF"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Check status</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> systemctl</span><span style="color:#9ECBFF"> status</span><span style="color:#9ECBFF"> docker</span></span></code></pre>
<h2 id="production-considerations">Production Considerations</h2>
<ul>
<li>Use specific Docker versions in production</li>
<li>Set up logging and monitoring</li>
<li>Configure resource limits</li>
<li>Implement security best practices</li>
<li>Use Docker in rootless mode when possible</li>
<li>Set up automated updates and backups</li>
</ul></div> </div><div class="directory-item" data-type="utility" data-url="proxmox-lxc-boot" data-content-length="8833" data-astro-cid-j7pv25f6> <span class="folder-icon" data-astro-cid-j7pv25f6>└─</span> <span class="project-path" data-astro-cid-j7pv25f6>/root/utilities/proxmox-lxc-boot</span> <!-- Hidden inline copy of the rendered markdown HTML (server-rendered). Inject raw HTML with set:html --> <div class="item-content" style="display:none;" data-astro-cid-j7pv25f6><h1 id="proxmox-lxc-initial-boot-script">Proxmox LXC Initial Boot Script</h1>
<p>This script automates the creation and initial setup of a Proxmox LXC container with Ubuntu 24.04, including Tailscale VPN setup for secure remote access.</p>
<h2 id="script">Script</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Generate next available container ID</span></span>
<span class="line"><span style="color:#E1E4E8">nextid</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">$(</span><span style="color:#B392F0">ls</span><span style="color:#9ECBFF"> /etc/pve/lxc/</span><span style="color:#79B8FF">*</span><span style="color:#9ECBFF">.conf</span><span style="color:#F97583"> 2></span><span style="color:#9ECBFF">/dev/null</span><span style="color:#F97583"> |</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#B392F0">         sed</span><span style="color:#9ECBFF"> 's/.*\///;s/\.conf//'</span><span style="color:#F97583"> |</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#B392F0">         sort</span><span style="color:#79B8FF"> -n</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> tail</span><span style="color:#79B8FF"> -n1</span><span style="color:#F97583"> |</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#B392F0">         awk</span><span style="color:#9ECBFF"> '{print $1+1}'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">last_digit</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"${</span><span style="color:#E1E4E8">nextid</span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> -1</span><span style="color:#9ECBFF">}"</span></span>
<span class="line"><span style="color:#E1E4E8">ctname</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"ctfd-${</span><span style="color:#E1E4E8">last_digit</span><span style="color:#9ECBFF">}"</span></span>
<span class="line"><span style="color:#E1E4E8">ctt</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"local:vztmpl/ubuntu-24.04-standard_24.04-2_amd64.tar.zst"</span></span>
<span class="line"><span style="color:#E1E4E8">cts</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"local-lvm"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Container specifications</span></span>
<span class="line"><span style="color:#E1E4E8">memory</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">1024</span></span>
<span class="line"><span style="color:#E1E4E8">swap</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">2048</span></span>
<span class="line"><span style="color:#E1E4E8">storage_space</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">20</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Create the container</span></span>
<span class="line"><span style="color:#B392F0">pct</span><span style="color:#9ECBFF"> create</span><span style="color:#E1E4E8"> ${nextid} ${ctt} </span><span style="color:#79B8FF">\</span></span>
<span class="line"><span style="color:#79B8FF">  --hostname=${</span><span style="color:#E1E4E8">ctname</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  --nameserver=1.1.1.1</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  --searchdomain=1.0.0.1</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  --password=${</span><span style="color:#E1E4E8">ctname</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  --ostype=ubuntu</span><span style="color:#79B8FF"> --unprivileged=0</span><span style="color:#79B8FF"> --features</span><span style="color:#9ECBFF"> nesting=</span><span style="color:#79B8FF">1</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  --net0</span><span style="color:#9ECBFF"> name=eth0,bridge=vmbr0,ip=dhcp</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  --arch=amd64</span><span style="color:#79B8FF"> --swap=${</span><span style="color:#E1E4E8">swap</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> --memory=${</span><span style="color:#E1E4E8">memory</span><span style="color:#79B8FF">}</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#79B8FF">  --storage=${</span><span style="color:#E1E4E8">cts</span><span style="color:#79B8FF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Resize storage and start container</span></span>
<span class="line"><span style="color:#B392F0">pct</span><span style="color:#9ECBFF"> resize</span><span style="color:#E1E4E8"> ${nextid} </span><span style="color:#9ECBFF">rootfs</span><span style="color:#9ECBFF"> +</span><span style="color:#E1E4E8">$((</span><span style="color:#B392F0">storage_space-4</span><span style="color:#E1E4E8">))</span><span style="color:#9ECBFF">G</span></span>
<span class="line"><span style="color:#B392F0">pct</span><span style="color:#9ECBFF"> start</span><span style="color:#E1E4E8"> ${nextid}</span></span>
<span class="line"><span style="color:#B392F0">pct</span><span style="color:#9ECBFF"> enter</span><span style="color:#E1E4E8"> ${nextid}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Update system and install Tailscale</span></span>
<span class="line"><span style="color:#B392F0">apt-get</span><span style="color:#9ECBFF"> update</span><span style="color:#E1E4E8"> &#x26;&#x26; </span><span style="color:#B392F0">apt-get</span><span style="color:#9ECBFF"> upgrade</span><span style="color:#79B8FF"> -y</span></span>
<span class="line"><span style="color:#B392F0">apt-get</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> curl</span><span style="color:#79B8FF"> -y</span></span>
<span class="line"><span style="color:#B392F0">curl</span><span style="color:#79B8FF"> -fsSL</span><span style="color:#9ECBFF"> https://tailscale.com/install.sh</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> sh</span></span>
<span class="line"><span style="color:#B392F0">systemctl</span><span style="color:#9ECBFF"> start</span><span style="color:#9ECBFF"> tailscaled</span></span>
<span class="line"><span style="color:#B392F0">tailscale</span><span style="color:#9ECBFF"> up</span></span></code></pre>
<h2 id="usage-notes">Usage Notes</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Run as root on Proxmox host</span></span>
<span class="line"><span style="color:#B392F0">bash</span><span style="color:#9ECBFF"> proxmox-lxc-boot.sh</span></span></code></pre>
<h3 id="what-the-script-does">What the script does:</h3>
<ul>
<li>Finds the next available container ID automatically</li>
<li>Creates Ubuntu 24.04 LXC container with specified resources</li>
<li>Configures network with DHCP and custom nameservers</li>
<li>Sets up storage with specified space allocation</li>
<li>Installs and configures Tailscale VPN for secure remote access</li>
<li>Container password is automatically set to container name</li>
</ul>
<h3 id="features">Features:</h3>
<ul>
<li><strong>Automatic ID generation</strong> - No manual container ID management</li>
<li><strong>Ubuntu 24.04</strong> - Latest stable Ubuntu LTS</li>
<li><strong>Tailscale integration</strong> - Secure mesh VPN out of the box</li>
<li><strong>Resource optimization</strong> - Balanced memory, swap, and storage</li>
<li><strong>Nesting enabled</strong> - Allows running Docker inside LXC</li>
</ul>
<h3 id="prerequisites">Prerequisites:</h3>
<ul>
<li>Proxmox VE installed and configured</li>
<li>Network bridge (vmbr0) configured</li>
<li>Storage (local-lvm) available</li>
<li>Root access on Proxmox host</li>
</ul>
<h3 id="customization">Customization:</h3>
<ul>
<li>Modify <code>memory</code>, <code>swap</code>, and <code>storage_space</code> variables as needed</li>
<li>Change <code>ctname</code> pattern for different naming conventions</li>
<li>Adjust network bridge if using different network configuration</li>
</ul></div> </div><div class="directory-item" data-type="utility" data-url="rootless-docker" data-content-length="18025" data-astro-cid-j7pv25f6> <span class="folder-icon" data-astro-cid-j7pv25f6>└─</span> <span class="project-path" data-astro-cid-j7pv25f6>/root/utilities/rootless-docker</span> <!-- Hidden inline copy of the rendered markdown HTML (server-rendered). Inject raw HTML with set:html --> <div class="item-content" style="display:none;" data-astro-cid-j7pv25f6><h1 id="rootless-docker-setup">Rootless Docker Setup</h1>
<p>Rootless Docker allows running Docker daemon and containers as a non-root user, improving security by reducing the attack surface and container breakout risks.</p>
<h2 id="installation-script">Installation Script</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Install prerequisites</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> apt-get</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> ca-certificates</span><span style="color:#9ECBFF"> curl</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> install</span><span style="color:#79B8FF"> -m</span><span style="color:#79B8FF"> 0755</span><span style="color:#79B8FF"> -d</span><span style="color:#9ECBFF"> /etc/apt/keyrings</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> curl</span><span style="color:#79B8FF"> -fsSL</span><span style="color:#9ECBFF"> https://download.docker.com/linux/ubuntu/gpg</span><span style="color:#79B8FF"> -o</span><span style="color:#9ECBFF"> /etc/apt/keyrings/docker.asc</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> chmod</span><span style="color:#9ECBFF"> a+r</span><span style="color:#9ECBFF"> /etc/apt/keyrings/docker.asc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Add the repository to Apt sources:</span></span>
<span class="line"><span style="color:#79B8FF">echo</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#9ECBFF">  "deb [arch=$(</span><span style="color:#B392F0">dpkg</span><span style="color:#79B8FF"> --print-architecture</span><span style="color:#9ECBFF">) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu </span><span style="color:#79B8FF">\</span></span>
<span class="line"><span style="color:#9ECBFF">  $(</span><span style="color:#79B8FF">.</span><span style="color:#9ECBFF"> /etc/os-release &#x26;&#x26; </span><span style="color:#79B8FF">echo</span><span style="color:#9ECBFF"> "${</span><span style="color:#E1E4E8">UBUNTU_CODENAME</span><span style="color:#F97583">:-</span><span style="color:#E1E4E8">$VERSION_CODENAME</span><span style="color:#9ECBFF">}") stable"</span><span style="color:#F97583"> |</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#B392F0">  sudo</span><span style="color:#9ECBFF"> tee</span><span style="color:#9ECBFF"> /etc/apt/sources.list.d/docker.list</span><span style="color:#F97583"> ></span><span style="color:#9ECBFF"> /dev/null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Install Docker packages</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> apt-get</span><span style="color:#9ECBFF"> update</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> apt</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> uidmap</span><span style="color:#9ECBFF"> docker-ce</span><span style="color:#9ECBFF"> docker-ce-cli</span><span style="color:#9ECBFF"> containerd.io</span><span style="color:#9ECBFF"> docker-buildx-plugin</span><span style="color:#9ECBFF"> docker-compose-plugin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Disable root Docker service</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> systemctl</span><span style="color:#9ECBFF"> disable</span><span style="color:#79B8FF"> --now</span><span style="color:#9ECBFF"> docker.service</span><span style="color:#9ECBFF"> docker.socket</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> rm</span><span style="color:#9ECBFF"> /var/run/docker.sock</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Create dedicated user for rootless Docker</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> groupadd</span><span style="color:#79B8FF"> --system</span><span style="color:#9ECBFF"> docker</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> useradd</span><span style="color:#79B8FF"> -m</span><span style="color:#79B8FF"> --system</span><span style="color:#79B8FF"> -g</span><span style="color:#9ECBFF"> docker</span><span style="color:#E1E4E8"> $TARGET_USER</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Set up rootless Docker</span></span>
<span class="line"><span style="color:#E1E4E8">PATH</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">/usr/bin:</span><span style="color:#E1E4E8">$PATH</span></span>
<span class="line"><span style="color:#B392F0">/usr/bin/dockerd-rootless-setuptool.sh</span><span style="color:#9ECBFF"> install</span></span></code></pre>
<h2 id="setup-instructions">Setup Instructions</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># 1. Replace $TARGET_USER with your desired username</span></span>
<span class="line"><span style="color:#6A737D"># 2. Run the installation script</span></span>
<span class="line"><span style="color:#B392F0">chmod</span><span style="color:#9ECBFF"> +x</span><span style="color:#9ECBFF"> rootless-docker-setup.sh</span></span>
<span class="line"><span style="color:#B392F0">./rootless-docker-setup.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># 3. Add environment variables to your shell profile</span></span>
<span class="line"><span style="color:#79B8FF">echo</span><span style="color:#9ECBFF"> 'export PATH=/usr/bin:$PATH'</span><span style="color:#F97583"> >></span><span style="color:#9ECBFF"> ~/.bashrc</span></span>
<span class="line"><span style="color:#79B8FF">echo</span><span style="color:#9ECBFF"> 'export DOCKER_HOST=unix:///run/user/$(id -u)/docker.sock'</span><span style="color:#F97583"> >></span><span style="color:#9ECBFF"> ~/.bashrc</span></span>
<span class="line"><span style="color:#79B8FF">source</span><span style="color:#9ECBFF"> ~/.bashrc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># 4. Start the rootless Docker service</span></span>
<span class="line"><span style="color:#B392F0">systemctl</span><span style="color:#79B8FF"> --user</span><span style="color:#9ECBFF"> start</span><span style="color:#9ECBFF"> docker</span></span>
<span class="line"><span style="color:#B392F0">systemctl</span><span style="color:#79B8FF"> --user</span><span style="color:#9ECBFF"> enable</span><span style="color:#9ECBFF"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># 5. Verify installation</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#79B8FF"> --version</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> run</span><span style="color:#9ECBFF"> hello-world</span></span></code></pre>
<h2 id="service-management">Service Management</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Start rootless Docker service</span></span>
<span class="line"><span style="color:#B392F0">systemctl</span><span style="color:#79B8FF"> --user</span><span style="color:#9ECBFF"> start</span><span style="color:#9ECBFF"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Stop rootless Docker service</span></span>
<span class="line"><span style="color:#B392F0">systemctl</span><span style="color:#79B8FF"> --user</span><span style="color:#9ECBFF"> stop</span><span style="color:#9ECBFF"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Check service status</span></span>
<span class="line"><span style="color:#B392F0">systemctl</span><span style="color:#79B8FF"> --user</span><span style="color:#9ECBFF"> status</span><span style="color:#9ECBFF"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Enable auto-start on boot</span></span>
<span class="line"><span style="color:#B392F0">systemctl</span><span style="color:#79B8FF"> --user</span><span style="color:#9ECBFF"> enable</span><span style="color:#9ECBFF"> docker</span></span>
<span class="line"><span style="color:#B392F0">loginctl</span><span style="color:#9ECBFF"> enable-linger</span><span style="color:#E1E4E8"> $USER</span></span></code></pre>
<h2 id="limitations--considerations">Limitations &#x26; Considerations</h2>
<h3 id="port-binding-limitations">Port Binding Limitations</h3>
<ul>
<li>Can only bind to ports >= 1024</li>
<li>Use port forwarding for privileged ports</li>
</ul>
<h3 id="network-limitations">Network Limitations</h3>
<ul>
<li>Some network drivers may not work</li>
<li>Host networking is restricted</li>
</ul>
<h3 id="storage-limitations">Storage Limitations</h3>
<ul>
<li>Some storage drivers may not be available</li>
<li>FUSE overlayfs is used by default</li>
</ul>
<h3 id="performance">Performance</h3>
<ul>
<li>Slightly reduced performance due to user namespace</li>
<li>Additional overhead for system calls</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Check if rootless mode is active</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> info</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> grep</span><span style="color:#79B8FF"> -i</span><span style="color:#9ECBFF"> rootless</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Check user namespace support</span></span>
<span class="line"><span style="color:#B392F0">cat</span><span style="color:#9ECBFF"> /proc/sys/kernel/unprivileged_userns_clone</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Enable user namespaces if disabled</span></span>
<span class="line"><span style="color:#79B8FF">echo</span><span style="color:#9ECBFF"> 'kernel.unprivileged_userns_clone=1'</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> sudo</span><span style="color:#9ECBFF"> tee</span><span style="color:#79B8FF"> -a</span><span style="color:#9ECBFF"> /etc/sysctl.conf</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> sysctl</span><span style="color:#79B8FF"> -p</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Fix permission issues</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> setcap</span><span style="color:#9ECBFF"> cap_net_bind_service=ep</span><span style="color:#E1E4E8"> $(</span><span style="color:#79B8FF">which</span><span style="color:#9ECBFF"> rootlesskit</span><span style="color:#E1E4E8">)</span></span></code></pre>
<h2 id="security-benefits">Security Benefits</h2>
<ul>
<li><strong>Reduced attack surface</strong> - No root privileges required</li>
<li><strong>User namespace isolation</strong> - Enhanced container security</li>
<li><strong>Container breakout protection</strong> - Limits damage from container escapes</li>
<li><strong>Better multi-user security</strong> - Each user has isolated Docker instances</li>
<li><strong>Compliance with security policies</strong> - Meets strict security requirements</li>
</ul>
<h2 id="port-forwarding-for-privileged-ports">Port Forwarding for Privileged Ports</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Forward port 80 to 8080 for web applications</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> iptables</span><span style="color:#79B8FF"> -t</span><span style="color:#9ECBFF"> nat</span><span style="color:#79B8FF"> -A</span><span style="color:#9ECBFF"> PREROUTING</span><span style="color:#79B8FF"> -p</span><span style="color:#9ECBFF"> tcp</span><span style="color:#79B8FF"> --dport</span><span style="color:#79B8FF"> 80</span><span style="color:#79B8FF"> -j</span><span style="color:#9ECBFF"> REDIRECT</span><span style="color:#79B8FF"> --to-port</span><span style="color:#79B8FF"> 8080</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Or use socat for simple forwarding</span></span>
<span class="line"><span style="color:#B392F0">socat</span><span style="color:#9ECBFF"> TCP-LISTEN:80,fork</span><span style="color:#9ECBFF"> TCP:localhost:8080</span></span></code></pre>
<h2 id="systemd-user-service">Systemd User Service</h2>
<p>Create <code>~/.config/systemd/user/docker.service</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ini"><code><span class="line"><span style="color:#B392F0">[Unit]</span></span>
<span class="line"><span style="color:#F97583">Description</span><span style="color:#E1E4E8">=Docker Application Container Engine (Rootless)</span></span>
<span class="line"><span style="color:#F97583">Documentation</span><span style="color:#E1E4E8">=https://docs.docker.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">[Service]</span></span>
<span class="line"><span style="color:#F97583">Type</span><span style="color:#E1E4E8">=notify</span></span>
<span class="line"><span style="color:#F97583">ExecStart</span><span style="color:#E1E4E8">=/usr/bin/dockerd-rootless.sh</span></span>
<span class="line"><span style="color:#F97583">ExecReload</span><span style="color:#E1E4E8">=/bin/kill -s HUP $MAINPID</span></span>
<span class="line"><span style="color:#F97583">TimeoutSec</span><span style="color:#E1E4E8">=0</span></span>
<span class="line"><span style="color:#F97583">RestartSec</span><span style="color:#E1E4E8">=2</span></span>
<span class="line"><span style="color:#F97583">Restart</span><span style="color:#E1E4E8">=always</span></span>
<span class="line"><span style="color:#F97583">StartLimitBurst</span><span style="color:#E1E4E8">=3</span></span>
<span class="line"><span style="color:#F97583">StartLimitInterval</span><span style="color:#E1E4E8">=60s</span></span>
<span class="line"><span style="color:#F97583">LimitNOFILE</span><span style="color:#E1E4E8">=infinity</span></span>
<span class="line"><span style="color:#F97583">LimitNPROC</span><span style="color:#E1E4E8">=infinity</span></span>
<span class="line"><span style="color:#F97583">LimitCORE</span><span style="color:#E1E4E8">=infinity</span></span>
<span class="line"><span style="color:#F97583">TasksMax</span><span style="color:#E1E4E8">=infinity</span></span>
<span class="line"><span style="color:#F97583">Delegate</span><span style="color:#E1E4E8">=yes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">[Install]</span></span>
<span class="line"><span style="color:#F97583">WantedBy</span><span style="color:#E1E4E8">=default.target</span></span></code></pre>
<h2 id="best-practices">Best Practices</h2>
<ul>
<li>Use rootless mode for development and testing</li>
<li>Consider rootless for production with proper security review</li>
<li>Monitor resource usage as rootless has higher overhead</li>
<li>Use volume mounts instead of bind mounts when possible</li>
<li>Keep the system updated with security patches</li>
</ul>
<h2 id="migration-from-root-docker">Migration from Root Docker</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># Stop root Docker</span></span>
<span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> systemctl</span><span style="color:#9ECBFF"> stop</span><span style="color:#9ECBFF"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Export containers and images</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> save</span><span style="color:#79B8FF"> -o</span><span style="color:#9ECBFF"> containers.tar</span><span style="color:#E1E4E8"> $(</span><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> images</span><span style="color:#79B8FF"> -q</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Start rootless Docker</span></span>
<span class="line"><span style="color:#B392F0">systemctl</span><span style="color:#79B8FF"> --user</span><span style="color:#9ECBFF"> start</span><span style="color:#9ECBFF"> docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Import containers and images</span></span>
<span class="line"><span style="color:#B392F0">docker</span><span style="color:#9ECBFF"> load</span><span style="color:#79B8FF"> -i</span><span style="color:#9ECBFF"> containers.tar</span></span></code></pre></div> </div><div class="directory-item" data-type="utility" data-url="rsync-backup" data-content-length="1847" data-astro-cid-j7pv25f6> <span class="folder-icon" data-astro-cid-j7pv25f6>└─</span> <span class="project-path" data-astro-cid-j7pv25f6>/root/utilities/rsync-backup</span> <!-- Hidden inline copy of the rendered markdown HTML (server-rendered). Inject raw HTML with set:html --> <div class="item-content" style="display:none;" data-astro-cid-j7pv25f6><h2 id="home-dir-full-backup">Home Dir full backup</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">sudo</span><span style="color:#9ECBFF"> rsync</span><span style="color:#79B8FF"> -a</span><span style="color:#79B8FF"> --info=progress2</span><span style="color:#79B8FF"> --exclude=</span><span style="color:#9ECBFF">"lost+found"</span><span style="color:#79B8FF"> --exclude=</span><span style="color:#9ECBFF">".cache"</span><span style="color:#79B8FF"> \</span></span>
<span class="line"><span style="color:#9ECBFF">    /home/</span><span style="color:#9ECBFF"> /mnt/usbdrive-name/</span></span></code></pre>
<h1 id="general-incremental-file-transfer">General incremental file transfer</h1>
<h2 id="local-to-local">Local to Local:</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">rsync</span><span style="color:#E1E4E8"> [OPTION]... [SRC]... DEST</span></span></code></pre>
<h2 id="local-to-remote">Local to Remote:</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">rsync</span><span style="color:#E1E4E8"> [OPTION]... [SRC]... [USER@]HOST:DEST</span></span></code></pre>
<h2 id="remote-to-local">Remote to Local:</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">rsync</span><span style="color:#E1E4E8"> [OPTION]... [USER@]HOST:SRC... [DEST]</span></span></code></pre></div> </div><div class="directory-item" data-type="utility" data-url="sops-nix-configuration" data-content-length="18469" data-astro-cid-j7pv25f6> <span class="folder-icon" data-astro-cid-j7pv25f6>└─</span> <span class="project-path" data-astro-cid-j7pv25f6>/root/utilities/sops-nix-configuration</span> <!-- Hidden inline copy of the rendered markdown HTML (server-rendered). Inject raw HTML with set:html --> <div class="item-content" style="display:none;" data-astro-cid-j7pv25f6><h1 id="sops-nix-configuration">sops-nix Configuration</h1>
<p>Modify the existing <code>flake.nix</code> as such:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="nix"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#B392F0">  inputs</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    nixpkgs</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">url</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "github:NixOS/nixpkgs/nixos-unstable"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">    nixd</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">url</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "github:nix-community/nixd/main"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">    nixfmt</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">url</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "github:NixOS/nixfmt/master"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">    home-manager</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">      url</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "github:nix-community/home-manager"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">      inputs</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">nixpkgs</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">follows</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "nixpkgs"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    ...</span></span>
<span class="line"><span style="color:#B392F0">    sops-nix</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">      url</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "github:Mic92/sops-nix"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">      inputs</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">nixpkgs</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">follows</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "nixpkgs"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  outputs</span><span style="color:#F97583"> =</span></span>
<span class="line"><span style="color:#E1E4E8">    inputs@{</span></span>
<span class="line"><span style="color:#E1E4E8">      self</span><span style="color:#F97583">,</span></span>
<span class="line"><span style="color:#E1E4E8">      nixpkgs</span><span style="color:#F97583">,</span></span>
<span class="line"><span style="color:#E1E4E8">      home-manager</span><span style="color:#F97583">,</span></span>
<span class="line"><span style="color:#E1E4E8">      sops-nix</span><span style="color:#F97583">,</span></span>
<span class="line"><span style="color:#F97583">      ...</span></span>
<span class="line"><span style="color:#E1E4E8">    }:</span></span>
<span class="line"><span style="color:#F97583">    ...</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#B392F0">      nixosConfigurations</span><span style="color:#E1E4E8">.</span><span style="color:#9ECBFF">"nixos"</span><span style="color:#F97583"> =</span><span style="color:#FFAB70"> nixpkgs</span><span style="color:#F97583">.</span><span style="color:#FFAB70">lib</span><span style="color:#F97583">.</span><span style="color:#FFAB70">nixosSystem</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        ...</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span><span style="color:#FDAEB7;font-style:italic">;</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">      ...</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">      sops-nix.nixosModules.sops</span></span></code></pre>
<p>Then, generate age key pair (recommended over GPG)</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">nix-shell</span><span style="color:#79B8FF"> -p</span><span style="color:#9ECBFF"> age</span><span style="color:#79B8FF"> --run</span><span style="color:#9ECBFF"> "age-keygen -o ~/.config/sops/age/keys.txt"</span></span>
<span class="line"><span style="color:#B392F0">cat</span><span style="color:#9ECBFF"> ~/.config/sops/age/keys.txt</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> grep</span><span style="color:#9ECBFF"> "public key:"</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> cut</span><span style="color:#79B8FF"> -d:</span><span style="color:#79B8FF"> -f2</span><span style="color:#F97583"> |</span><span style="color:#B392F0"> xargs</span></span></code></pre>
<p>The second command should print the generated public key, which we will store in <code>/etc/nixos/.sops.yaml</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="nix"><code><span class="line"><span style="color:#E1E4E8">creation_rules:</span></span>
<span class="line"><span style="color:#F97583">  -</span><span style="color:#E1E4E8"> path_regex: </span><span style="color:#9ECBFF">secrets/.</span><span style="color:#F97583">*</span><span style="color:#FDAEB7;font-style:italic">\</span><span style="color:#F97583">.</span><span style="color:#FFAB70">yaml</span><span style="color:#FDAEB7;font-style:italic">$</span></span>
<span class="line"><span style="color:#E1E4E8">    key_groups:</span></span>
<span class="line"><span style="color:#F97583">      -</span><span style="color:#E1E4E8"> age:</span></span>
<span class="line"><span style="color:#F97583">          -</span><span style="color:#9ECBFF"> "PUBLIC_KEY"</span></span></code></pre>
<p>Next, we create the unencrypted file in <code>/etc/nixos/secrets.yaml</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="yaml"><code><span class="line"><span style="color:#85E89D">KEY_1</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">VALUE</span></span>
<span class="line"><span style="color:#85E89D">KEY_2</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">ANOTHER_VALUE</span></span>
<span class="line"><span style="color:#B392F0">...</span><span style="color:#79B8FF">.</span></span></code></pre>
<p>Which we encrypt with:</p>
<p><code>nix-shell -p sops --run "sops --config /etc/nixos/secrets.yaml --encrypt --in-place /etc/nixos/secrets/secrets-enc.yaml"</code></p>
<p><em><strong>IMPORTANT NOTE:</strong></em> NEVER forget to keep a <code>.gitignore</code> here, and to update it with the name of the <code>secrets.yaml</code> file, since it will contain all the unencrypted secrets.</p>
<p>After this, we create the file <code>/etc/nixos/sops.nix</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="nix"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#B392F0">  sops</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    defaultSopsFile</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> ./secrets/secrets.yaml</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">    age</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">keyFile</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "/home/hytx/.config/sops/age/keys.txt"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">    secrets</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">      deepseekAPIKey</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        mode</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "0400"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        owner</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "root"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        group</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "root"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        path</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "/run/secrets/deepseek-api-key"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">      };</span></span>
<span class="line"><span style="color:#B392F0">      xSTFCTFDToken</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        mode</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "0400"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        owner</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "root"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        group</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "root"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        path</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "/run/secrets/ctfd-token"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">      };</span></span>
<span class="line"><span style="color:#B392F0">      xSTFCTFDURL</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        mode</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "0400"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        owner</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "root"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        group</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "root"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        path</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "/run/secrets/ctfd-url"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">      };</span></span>
<span class="line"><span style="color:#B392F0">      xSTFCTFDDeployHost</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        mode</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "0400"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        owner</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "root"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        group</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "root"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        path</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "/run/secrets/ctfd-deploy-host"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">      };</span></span>
<span class="line"><span style="color:#B392F0">      INESCTECVPNConfig</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        mode</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "0400"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        owner</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "root"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        group</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "root"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        path</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "/etc/openvpn/inesctec.conf"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#B392F0">        sopsFile</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> ./secrets/secrets.yaml</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">      };</span></span>
<span class="line"><span style="color:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>And import it in <code>configuration.nix</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="nix"><code><span class="line"><span style="color:#E1E4E8">{ </span><span style="color:#F97583">... </span><span style="color:#E1E4E8">}:</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#B392F0">  imports</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span></span>
<span class="line"><span style="color:#9ECBFF">    ./hardware-configuration.nix</span></span>
<span class="line"><span style="color:#F97583">    ...</span></span>
<span class="line"><span style="color:#9ECBFF">    ./sops.nix</span></span>
<span class="line"><span style="color:#E1E4E8">  ];</span></span></code></pre>
<p>The secrets will be created in <code>/run/secrets/KEY_NAME</code>, with this configuration, being read-only only by root.</p>
<h2 id="secret-usage-in-nix-configuration-files">Secret usage in Nix configuration files</h2>
<p>Since the secrets are stored in <code>/run</code>, we need to access them out-of-band, outside of the evaluation time when rebuilding the system.</p>
<p>The way we do this is, instead of realizing the actual path on rebuild, we set environment variables to read from the key paths:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="nix"><code><span class="line"><span style="color:#E1E4E8">{ </span><span style="color:#F97583">... </span><span style="color:#E1E4E8">}:</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#B392F0">  environment</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    ...</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">    shellInit</span><span style="color:#FDAEB7;font-style:italic"> =</span><span style="color:#FDAEB7;font-style:italic"> ''</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">      ...</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">      if</span><span style="color:#FDAEB7;font-style:italic"> [</span><span style="color:#FDAEB7;font-style:italic"> -f</span><span style="color:#FDAEB7;font-style:italic"> /run/secrets/KEY_1</span><span style="color:#FDAEB7;font-style:italic"> ];</span><span style="color:#FDAEB7;font-style:italic"> then</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">        export</span><span style="color:#FDAEB7;font-style:italic"> KEY_1="$(cat</span><span style="color:#FDAEB7;font-style:italic"> /run/secrets/KEY_1)"</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">      fi</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">      if</span><span style="color:#FDAEB7;font-style:italic"> [</span><span style="color:#FDAEB7;font-style:italic"> -f</span><span style="color:#FDAEB7;font-style:italic"> /run/secrets/KEY_2</span><span style="color:#FDAEB7;font-style:italic"> ];</span><span style="color:#FDAEB7;font-style:italic"> then</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">        export</span><span style="color:#FDAEB7;font-style:italic"> KEY_2="$(cat</span><span style="color:#FDAEB7;font-style:italic"> /run/secrets/KEY_2)"</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">      fi</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">      ...</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">    '';</span></span>
<span class="line"><span style="color:#FDAEB7;font-style:italic">    ...</span></span></code></pre>
<h2 id="updating-secrets">Updating secrets</h2>
<p>Simply use <code>nix-shell -p sops --run "sops /etc/nixos/secrets/secrets.yaml"</code> to live edit the secrets, do not forget to include/exclude them from the <code>sops.nix</code> file, or the rebuild will fail.</p></div> </div><div class="directory-item" data-type="utility" data-url="utility-belt" data-content-length="2261" data-astro-cid-j7pv25f6> <span class="folder-icon" data-astro-cid-j7pv25f6>└─</span> <span class="project-path" data-astro-cid-j7pv25f6>/root/utilities/utility-belt</span> <!-- Hidden inline copy of the rendered markdown HTML (server-rendered). Inject raw HTML with set:html --> <div class="item-content" style="display:none;" data-astro-cid-j7pv25f6><h1 id="utility-belt">Utility Belt</h1>
<p>n- iffy, uh, blicky got the stiffy, uh
Got the blicky, uh, drum, it hold fifty, uh</p>
<h2 id="available-utilities">Available Utilities</h2>
<h3 id="system-utilities">System Utilities</h3>
<ul>
<li><strong>proxmox-lxc-boot</strong> - Initial boot for Proxmox LXC containers</li>
<li><strong>docker-install</strong> - Complete Docker installation script</li>
<li><strong>rootless-docker</strong> - Secure rootless Docker setup</li>
</ul>
<h3 id="security--networking">Security &#x26; Networking</h3>
<ul>
<li><strong>certificate-generation</strong> - SSL certificate generation with Certbot</li>
</ul>
<h2 id="navigation-commands">Navigation Commands</h2>
<p>Use the terminal commands to navigate and access utilities:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#6A737D"># List available directories</span></span>
<span class="line"><span style="color:#B392F0">ls</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Navigate to utilities</span></span>
<span class="line"><span style="color:#79B8FF">cd</span><span style="color:#9ECBFF"> utilities</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># List utilities</span></span>
<span class="line"><span style="color:#B392F0">ls</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Open a utility</span></span>
<span class="line"><span style="color:#B392F0">cat</span><span style="color:#9ECBFF"> utility-name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Get help</span></span>
<span class="line"><span style="color:#B392F0">help</span></span></code></pre>
<h2 id="quick-access">Quick Access</h2>
<ul>
<li><strong>ESC</strong> - Toggle terminal input focus</li>
<li><strong>Backspace</strong> - Go back from utility view</li>
<li><strong>Arrow keys</strong> - Navigate directory items</li>
<li><strong>Enter</strong> - Select/activate items</li>
</ul>
<p>All utilities are designed to be practical, production-ready scripts that can be used directly in your projects.</p></div> </div> </div> <div id="utility-view" class="utility-content" data-astro-cid-j7pv25f6> <div class="utility-content-inner" data-astro-cid-j7pv25f6> <div class="back-button" id="back-button" data-astro-cid-j7pv25f6>← Back to directory</div> <div id="utility-content" data-astro-cid-j7pv25f6></div> </div> </div> </div> </div> <div class="terminal" data-astro-cid-j7pv25f6> <div class="footer" data-astro-cid-j7pv25f6> <span data-astro-cid-j7pv25f6>Press ESC to toggle keyboard input focus</span> </div> <div class="terminal-output" id="terminal-output" data-astro-cid-j7pv25f6></div> <div class="real-terminal" data-astro-cid-j7pv25f6> <div class="terminal-prompt" data-astro-cid-j7pv25f6>[rootHytx@github.io: <span id="prompt-dir" data-astro-cid-j7pv25f6>~</span>]$</div> <input type="text" class="terminal-input" id="terminal-input" placeholder="Type commands here..." data-astro-cid-j7pv25f6> </div> </div> <script type="module" src="/_astro/index.astro_astro_type_script_index_0_lang.CXC9d7G5.js"></script> <script>
			window.utilitiesData = [{"id":"certificate-generation","title":"Certificate Generation","description":"SSL certificate generation using Certbot with DNS challenge validation","category":"security","content":"<h1 id=\"ssl-certificate-generation\">SSL Certificate Generation</h1>\n<p>Generate SSL certificates using Certbot with DNS challenge validation. This method is ideal for automated certificate generation and wildcard certificates.</p>\n<h2 id=\"docker-certbot-command\">Docker Certbot Command</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#79B8FF\"> -it</span><span style=\"color:#79B8FF\"> --rm</span><span style=\"color:#79B8FF\"> --name</span><span style=\"color:#9ECBFF\"> certbot</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -v</span><span style=\"color:#9ECBFF\"> \"./certs:/etc/letsencrypt\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  certbot/certbot</span><span style=\"color:#9ECBFF\"> certonly</span><span style=\"color:#79B8FF\"> --manual</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  --preferred-challenges</span><span style=\"color:#9ECBFF\"> dns</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> DOMAIN</span></span></code></pre>\n<h2 id=\"manual-dns-challenge-steps\">Manual DNS Challenge Steps</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># 1. Run the Docker command above</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 2. Certbot will prompt you to create DNS TXT records</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 3. Add the TXT records to your DNS provider</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 4. Wait for DNS propagation (usually 1-5 minutes)</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 5. Press Enter to continue validation</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 6. Certificates will be saved in ./certs/</span></span></code></pre>\n<h2 id=\"example-usage\">Example Usage</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Generate certificate for example.com</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#79B8FF\"> -it</span><span style=\"color:#79B8FF\"> --rm</span><span style=\"color:#79B8FF\"> --name</span><span style=\"color:#9ECBFF\"> certbot</span><span style=\"color:#79B8FF\"> -v</span><span style=\"color:#9ECBFF\"> \"./certs:/etc/letsencrypt\"</span><span style=\"color:#9ECBFF\"> certbot/certbot</span><span style=\"color:#9ECBFF\"> certonly</span><span style=\"color:#79B8FF\"> --manual</span><span style=\"color:#79B8FF\"> --preferred-challenges</span><span style=\"color:#9ECBFF\"> dns</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#9ECBFF\"> example.com</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#79B8FF\"> *</span><span style=\"color:#9ECBFF\">.example.com</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Generate wildcard certificate</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#79B8FF\"> -it</span><span style=\"color:#79B8FF\"> --rm</span><span style=\"color:#79B8FF\"> --name</span><span style=\"color:#9ECBFF\"> certbot</span><span style=\"color:#79B8FF\"> -v</span><span style=\"color:#9ECBFF\"> \"./certs:/etc/letsencrypt\"</span><span style=\"color:#9ECBFF\"> certbot/certbot</span><span style=\"color:#9ECBFF\"> certonly</span><span style=\"color:#79B8FF\"> --manual</span><span style=\"color:#79B8FF\"> --preferred-challenges</span><span style=\"color:#9ECBFF\"> dns</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#9ECBFF\"> \"*.example.com\"</span></span></code></pre>\n<h2 id=\"certificate-locations\">Certificate Locations</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Generated certificates will be in:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">./certs/live/DOMAIN/fullchain.pem</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">./certs/live/DOMAIN/privkey.pem</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">./certs/live/DOMAIN/cert.pem</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">./certs/live/DOMAIN/chain.pem</span></span></code></pre>\n<h2 id=\"automation-tips\">Automation Tips</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Use DNS provider APIs for automated validation</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Set up cron jobs for automatic renewal</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Use --dry-run to test without generating real certificates</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Combine with Docker Compose for easier management</span></span></code></pre>\n<h2 id=\"dns-provider-integration\">DNS Provider Integration</h2>\n<h3 id=\"cloudflare\">Cloudflare</h3>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Use Cloudflare API token with DNS challenge</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#79B8FF\"> -it</span><span style=\"color:#79B8FF\"> --rm</span><span style=\"color:#79B8FF\"> --name</span><span style=\"color:#9ECBFF\"> certbot</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -v</span><span style=\"color:#9ECBFF\"> \"./certs:/etc/letsencrypt\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -e</span><span style=\"color:#9ECBFF\"> CLOUDFLARE_API_TOKEN=your_token</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  certbot/dns-cloudflare</span><span style=\"color:#9ECBFF\"> certonly</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  --dns-cloudflare</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> example.com</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#79B8FF\"> *</span><span style=\"color:#9ECBFF\">.example.com</span></span></code></pre>\n<h3 id=\"route53\">Route53</h3>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Use AWS credentials for Route53</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#79B8FF\"> -it</span><span style=\"color:#79B8FF\"> --rm</span><span style=\"color:#79B8FF\"> --name</span><span style=\"color:#9ECBFF\"> certbot</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -v</span><span style=\"color:#9ECBFF\"> \"./certs:/etc/letsencrypt\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -e</span><span style=\"color:#9ECBFF\"> AWS_ACCESS_KEY_ID=your_key</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -e</span><span style=\"color:#9ECBFF\"> AWS_SECRET_ACCESS_KEY=your_secret</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  certbot/dns-route53</span><span style=\"color:#9ECBFF\"> certonly</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  --dns-route53</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -d</span><span style=\"color:#9ECBFF\"> example.com</span></span></code></pre>\n<h2 id=\"renewal-commands\">Renewal Commands</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Test renewal (dry run)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#79B8FF\"> -it</span><span style=\"color:#79B8FF\"> --rm</span><span style=\"color:#79B8FF\"> --name</span><span style=\"color:#9ECBFF\"> certbot</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -v</span><span style=\"color:#9ECBFF\"> \"./certs:/etc/letsencrypt\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  certbot/certbot</span><span style=\"color:#9ECBFF\"> renew</span><span style=\"color:#79B8FF\"> --dry-run</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Actual renewal</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#79B8FF\"> -it</span><span style=\"color:#79B8FF\"> --rm</span><span style=\"color:#79B8FF\"> --name</span><span style=\"color:#9ECBFF\"> certbot</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  -v</span><span style=\"color:#9ECBFF\"> \"./certs:/etc/letsencrypt\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  certbot/certbot</span><span style=\"color:#9ECBFF\"> renew</span></span></code></pre>\n<h2 id=\"certificate-types\">Certificate Types</h2>\n<ul>\n<li><strong>Single Domain</strong>: Certificate for one specific domain</li>\n<li><strong>Multiple Domains</strong>: Certificate covering multiple domains</li>\n<li><strong>Wildcard</strong>: Certificate for all subdomains (*.example.com)</li>\n<li><strong>SAN (Subject Alternative Name)</strong>: Certificate with multiple domain names</li>\n</ul>\n<h2 id=\"best-practices\">Best Practices</h2>\n<ul>\n<li>Use wildcard certificates for subdomains</li>\n<li>Set up automatic renewal (certificates expire every 90 days)</li>\n<li>Test with —dry-run before production use</li>\n<li>Store certificates securely with proper permissions</li>\n<li>Use environment variables for sensitive data</li>\n<li>Monitor certificate expiration dates</li>\n</ul>"},{"id":"docker-install","title":"Docker Installation","description":"Complete Docker installation script for Ubuntu systems from official repositories","category":"docker","content":"<h1 id=\"docker-installation-script\">Docker Installation Script</h1>\n<p>Complete Docker installation script for Ubuntu systems. This script installs the latest Docker Engine from Docker’s official repositories.</p>\n<h2 id=\"installation-script\">Installation Script</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\">#!/bin/bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Remove old Docker versions</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">for</span><span style=\"color:#E1E4E8\"> pkg </span><span style=\"color:#F97583\">in</span><span style=\"color:#9ECBFF\"> docker.io</span><span style=\"color:#9ECBFF\"> docker-doc</span><span style=\"color:#9ECBFF\"> docker-compose</span><span style=\"color:#9ECBFF\"> docker-compose-v2</span><span style=\"color:#9ECBFF\"> podman-docker</span><span style=\"color:#9ECBFF\"> containerd</span><span style=\"color:#9ECBFF\"> runc</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#F97583\">do</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  sudo</span><span style=\"color:#9ECBFF\"> apt-get</span><span style=\"color:#9ECBFF\"> remove</span><span style=\"color:#E1E4E8\"> $pkg</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">done</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Add Docker's official GPG key:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> apt-get</span><span style=\"color:#9ECBFF\"> update</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> apt-get</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#9ECBFF\"> ca-certificates</span><span style=\"color:#9ECBFF\"> curl</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#79B8FF\"> -m</span><span style=\"color:#79B8FF\"> 0755</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#9ECBFF\"> /etc/apt/keyrings</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> curl</span><span style=\"color:#79B8FF\"> -fsSL</span><span style=\"color:#9ECBFF\"> https://download.docker.com/linux/ubuntu/gpg</span><span style=\"color:#79B8FF\"> -o</span><span style=\"color:#9ECBFF\"> /etc/apt/keyrings/docker.asc</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> chmod</span><span style=\"color:#9ECBFF\"> a+r</span><span style=\"color:#9ECBFF\"> /etc/apt/keyrings/docker.asc</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Add the repository to Apt sources:</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">echo</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  \"deb [arch=$(</span><span style=\"color:#B392F0\">dpkg</span><span style=\"color:#79B8FF\"> --print-architecture</span><span style=\"color:#9ECBFF\">) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu </span><span style=\"color:#79B8FF\">\\</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  $(</span><span style=\"color:#79B8FF\">.</span><span style=\"color:#9ECBFF\"> /etc/os-release &#x26;&#x26; </span><span style=\"color:#79B8FF\">echo</span><span style=\"color:#9ECBFF\"> \"${</span><span style=\"color:#E1E4E8\">UBUNTU_CODENAME</span><span style=\"color:#F97583\">:-</span><span style=\"color:#E1E4E8\">$VERSION_CODENAME</span><span style=\"color:#9ECBFF\">}\") stable\"</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  sudo</span><span style=\"color:#9ECBFF\"> tee</span><span style=\"color:#9ECBFF\"> /etc/apt/sources.list.d/docker.list</span><span style=\"color:#F97583\"> ></span><span style=\"color:#9ECBFF\"> /dev/null</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Install Docker Engine</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> apt-get</span><span style=\"color:#9ECBFF\"> update</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> apt-get</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#9ECBFF\"> docker-ce</span><span style=\"color:#9ECBFF\"> docker-ce-cli</span><span style=\"color:#9ECBFF\"> containerd.io</span><span style=\"color:#9ECBFF\"> docker-buildx-plugin</span><span style=\"color:#9ECBFF\"> docker-compose-plugin</span></span></code></pre>\n<h2 id=\"post-installation-steps\">Post-Installation Steps</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Add your user to the docker group</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> usermod</span><span style=\"color:#79B8FF\"> -aG</span><span style=\"color:#9ECBFF\"> docker</span><span style=\"color:#E1E4E8\"> $USER</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Activate group changes (log out and back in, or run:)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">newgrp</span><span style=\"color:#9ECBFF\"> docker</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Verify installation</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#79B8FF\"> --version</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> compose</span><span style=\"color:#9ECBFF\"> version</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Test Docker</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> hello-world</span></span></code></pre>\n<h2 id=\"usage-notes\">Usage Notes</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Save the script as install-docker.sh</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">chmod</span><span style=\"color:#9ECBFF\"> +x</span><span style=\"color:#9ECBFF\"> install-docker.sh</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">./install-docker.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Or run directly:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -fsSL</span><span style=\"color:#9ECBFF\"> https://get.docker.com</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Warning: The script removes existing Docker installations</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Make sure to backup any important containers/data</span></span></code></pre>\n<h2 id=\"alternative-one-line-install\">Alternative: One-Line Install</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Use Docker's official install script:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -fsSL</span><span style=\"color:#9ECBFF\"> https://get.docker.com</span><span style=\"color:#79B8FF\"> -o</span><span style=\"color:#9ECBFF\"> get-docker.sh</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> sh</span><span style=\"color:#9ECBFF\"> get-docker.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Or direct pipe:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -fsSL</span><span style=\"color:#9ECBFF\"> https://get.docker.com</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> sh</span></span></code></pre>\n<h2 id=\"uninstall-docker\">Uninstall Docker</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Remove Docker packages</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> apt-get</span><span style=\"color:#9ECBFF\"> purge</span><span style=\"color:#9ECBFF\"> docker-ce</span><span style=\"color:#9ECBFF\"> docker-ce-cli</span><span style=\"color:#9ECBFF\"> containerd.io</span><span style=\"color:#9ECBFF\"> docker-buildx-plugin</span><span style=\"color:#9ECBFF\"> docker-compose-plugin</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Remove images, containers, and volumes</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> rm</span><span style=\"color:#79B8FF\"> -rf</span><span style=\"color:#9ECBFF\"> /var/lib/docker</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> rm</span><span style=\"color:#79B8FF\"> -rf</span><span style=\"color:#9ECBFF\"> /var/lib/containerd</span></span></code></pre>\n<h2 id=\"docker-compose-setup\">Docker Compose Setup</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Install Docker Compose (if not included)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> apt-get</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#9ECBFF\"> docker-compose-plugin</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Verify Docker Compose</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> compose</span><span style=\"color:#9ECBFF\"> version</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Create docker-compose.yml file</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cat</span><span style=\"color:#F97583\"> ></span><span style=\"color:#9ECBFF\"> docker-compose.yml</span><span style=\"color:#F97583\"> &#x3C;&#x3C;</span><span style=\"color:#9ECBFF\"> 'EOF'</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">version: '3.8'</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">services:</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  web:</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    image: nginx:alpine</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    ports:</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">      - \"80:80\"</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">EOF</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Run with Docker Compose</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> compose</span><span style=\"color:#9ECBFF\"> up</span><span style=\"color:#79B8FF\"> -d</span></span></code></pre>\n<h2 id=\"common-issues\">Common Issues</h2>\n<h3 id=\"permission-denied\">Permission Denied</h3>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># If you get \"Got permission denied\" error:</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> usermod</span><span style=\"color:#79B8FF\"> -aG</span><span style=\"color:#9ECBFF\"> docker</span><span style=\"color:#E1E4E8\"> $USER</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">newgrp</span><span style=\"color:#9ECBFF\"> docker</span></span></code></pre>\n<h3 id=\"port-already-in-use\">Port Already in Use</h3>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Check what's using the port</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> netstat</span><span style=\"color:#79B8FF\"> -tulpn</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> grep</span><span style=\"color:#9ECBFF\"> :80</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Or use lsof</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> lsof</span><span style=\"color:#79B8FF\"> -i</span><span style=\"color:#9ECBFF\"> :80</span></span></code></pre>\n<h3 id=\"docker-daemon-not-running\">Docker Daemon Not Running</h3>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Start Docker service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> systemctl</span><span style=\"color:#9ECBFF\"> start</span><span style=\"color:#9ECBFF\"> docker</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> systemctl</span><span style=\"color:#9ECBFF\"> enable</span><span style=\"color:#9ECBFF\"> docker</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Check status</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> systemctl</span><span style=\"color:#9ECBFF\"> status</span><span style=\"color:#9ECBFF\"> docker</span></span></code></pre>\n<h2 id=\"production-considerations\">Production Considerations</h2>\n<ul>\n<li>Use specific Docker versions in production</li>\n<li>Set up logging and monitoring</li>\n<li>Configure resource limits</li>\n<li>Implement security best practices</li>\n<li>Use Docker in rootless mode when possible</li>\n<li>Set up automated updates and backups</li>\n</ul>"},{"id":"proxmox-lxc-boot","title":"Proxmox LXC Initial Boot","description":"Automated Proxmox LXC container creation with Ubuntu 24.04 and Tailscale VPN setup","category":"system","content":"<h1 id=\"proxmox-lxc-initial-boot-script\">Proxmox LXC Initial Boot Script</h1>\n<p>This script automates the creation and initial setup of a Proxmox LXC container with Ubuntu 24.04, including Tailscale VPN setup for secure remote access.</p>\n<h2 id=\"script\">Script</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\">#!/bin/bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Generate next available container ID</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">nextid</span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\">$(</span><span style=\"color:#B392F0\">ls</span><span style=\"color:#9ECBFF\"> /etc/pve/lxc/</span><span style=\"color:#79B8FF\">*</span><span style=\"color:#9ECBFF\">.conf</span><span style=\"color:#F97583\"> 2></span><span style=\"color:#9ECBFF\">/dev/null</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">         sed</span><span style=\"color:#9ECBFF\"> 's/.*\\///;s/\\.conf//'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">         sort</span><span style=\"color:#79B8FF\"> -n</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> tail</span><span style=\"color:#79B8FF\"> -n1</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">         awk</span><span style=\"color:#9ECBFF\"> '{print $1+1}'</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">last_digit</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">\"${</span><span style=\"color:#E1E4E8\">nextid</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> -1</span><span style=\"color:#9ECBFF\">}\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">ctname</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">\"ctfd-${</span><span style=\"color:#E1E4E8\">last_digit</span><span style=\"color:#9ECBFF\">}\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">ctt</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">\"local:vztmpl/ubuntu-24.04-standard_24.04-2_amd64.tar.zst\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">cts</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">\"local-lvm\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Container specifications</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">memory</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">1024</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">swap</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">2048</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">storage_space</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">20</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Create the container</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">pct</span><span style=\"color:#9ECBFF\"> create</span><span style=\"color:#E1E4E8\"> ${nextid} ${ctt} </span><span style=\"color:#79B8FF\">\\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  --hostname=${</span><span style=\"color:#E1E4E8\">ctname</span><span style=\"color:#79B8FF\">}</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  --nameserver=1.1.1.1</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  --searchdomain=1.0.0.1</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  --password=${</span><span style=\"color:#E1E4E8\">ctname</span><span style=\"color:#79B8FF\">}</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  --ostype=ubuntu</span><span style=\"color:#79B8FF\"> --unprivileged=0</span><span style=\"color:#79B8FF\"> --features</span><span style=\"color:#9ECBFF\"> nesting=</span><span style=\"color:#79B8FF\">1</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  --net0</span><span style=\"color:#9ECBFF\"> name=eth0,bridge=vmbr0,ip=dhcp</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  --arch=amd64</span><span style=\"color:#79B8FF\"> --swap=${</span><span style=\"color:#E1E4E8\">swap</span><span style=\"color:#79B8FF\">}</span><span style=\"color:#79B8FF\"> --memory=${</span><span style=\"color:#E1E4E8\">memory</span><span style=\"color:#79B8FF\">}</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">  --storage=${</span><span style=\"color:#E1E4E8\">cts</span><span style=\"color:#79B8FF\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Resize storage and start container</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">pct</span><span style=\"color:#9ECBFF\"> resize</span><span style=\"color:#E1E4E8\"> ${nextid} </span><span style=\"color:#9ECBFF\">rootfs</span><span style=\"color:#9ECBFF\"> +</span><span style=\"color:#E1E4E8\">$((</span><span style=\"color:#B392F0\">storage_space-4</span><span style=\"color:#E1E4E8\">))</span><span style=\"color:#9ECBFF\">G</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">pct</span><span style=\"color:#9ECBFF\"> start</span><span style=\"color:#E1E4E8\"> ${nextid}</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">pct</span><span style=\"color:#9ECBFF\"> enter</span><span style=\"color:#E1E4E8\"> ${nextid}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Update system and install Tailscale</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">apt-get</span><span style=\"color:#9ECBFF\"> update</span><span style=\"color:#E1E4E8\"> &#x26;&#x26; </span><span style=\"color:#B392F0\">apt-get</span><span style=\"color:#9ECBFF\"> upgrade</span><span style=\"color:#79B8FF\"> -y</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">apt-get</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#9ECBFF\"> curl</span><span style=\"color:#79B8FF\"> -y</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">curl</span><span style=\"color:#79B8FF\"> -fsSL</span><span style=\"color:#9ECBFF\"> https://tailscale.com/install.sh</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> sh</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">systemctl</span><span style=\"color:#9ECBFF\"> start</span><span style=\"color:#9ECBFF\"> tailscaled</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">tailscale</span><span style=\"color:#9ECBFF\"> up</span></span></code></pre>\n<h2 id=\"usage-notes\">Usage Notes</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Run as root on Proxmox host</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">bash</span><span style=\"color:#9ECBFF\"> proxmox-lxc-boot.sh</span></span></code></pre>\n<h3 id=\"what-the-script-does\">What the script does:</h3>\n<ul>\n<li>Finds the next available container ID automatically</li>\n<li>Creates Ubuntu 24.04 LXC container with specified resources</li>\n<li>Configures network with DHCP and custom nameservers</li>\n<li>Sets up storage with specified space allocation</li>\n<li>Installs and configures Tailscale VPN for secure remote access</li>\n<li>Container password is automatically set to container name</li>\n</ul>\n<h3 id=\"features\">Features:</h3>\n<ul>\n<li><strong>Automatic ID generation</strong> - No manual container ID management</li>\n<li><strong>Ubuntu 24.04</strong> - Latest stable Ubuntu LTS</li>\n<li><strong>Tailscale integration</strong> - Secure mesh VPN out of the box</li>\n<li><strong>Resource optimization</strong> - Balanced memory, swap, and storage</li>\n<li><strong>Nesting enabled</strong> - Allows running Docker inside LXC</li>\n</ul>\n<h3 id=\"prerequisites\">Prerequisites:</h3>\n<ul>\n<li>Proxmox VE installed and configured</li>\n<li>Network bridge (vmbr0) configured</li>\n<li>Storage (local-lvm) available</li>\n<li>Root access on Proxmox host</li>\n</ul>\n<h3 id=\"customization\">Customization:</h3>\n<ul>\n<li>Modify <code>memory</code>, <code>swap</code>, and <code>storage_space</code> variables as needed</li>\n<li>Change <code>ctname</code> pattern for different naming conventions</li>\n<li>Adjust network bridge if using different network configuration</li>\n</ul>"},{"id":"rootless-docker","title":"Rootless Docker Setup","description":"Secure rootless Docker daemon setup for running containers without root privileges","category":"docker","content":"<h1 id=\"rootless-docker-setup\">Rootless Docker Setup</h1>\n<p>Rootless Docker allows running Docker daemon and containers as a non-root user, improving security by reducing the attack surface and container breakout risks.</p>\n<h2 id=\"installation-script\">Installation Script</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\">#!/bin/bash</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Install prerequisites</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> apt-get</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#9ECBFF\"> ca-certificates</span><span style=\"color:#9ECBFF\"> curl</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#79B8FF\"> -m</span><span style=\"color:#79B8FF\"> 0755</span><span style=\"color:#79B8FF\"> -d</span><span style=\"color:#9ECBFF\"> /etc/apt/keyrings</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> curl</span><span style=\"color:#79B8FF\"> -fsSL</span><span style=\"color:#9ECBFF\"> https://download.docker.com/linux/ubuntu/gpg</span><span style=\"color:#79B8FF\"> -o</span><span style=\"color:#9ECBFF\"> /etc/apt/keyrings/docker.asc</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> chmod</span><span style=\"color:#9ECBFF\"> a+r</span><span style=\"color:#9ECBFF\"> /etc/apt/keyrings/docker.asc</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Add the repository to Apt sources:</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">echo</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  \"deb [arch=$(</span><span style=\"color:#B392F0\">dpkg</span><span style=\"color:#79B8FF\"> --print-architecture</span><span style=\"color:#9ECBFF\">) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu </span><span style=\"color:#79B8FF\">\\</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  $(</span><span style=\"color:#79B8FF\">.</span><span style=\"color:#9ECBFF\"> /etc/os-release &#x26;&#x26; </span><span style=\"color:#79B8FF\">echo</span><span style=\"color:#9ECBFF\"> \"${</span><span style=\"color:#E1E4E8\">UBUNTU_CODENAME</span><span style=\"color:#F97583\">:-</span><span style=\"color:#E1E4E8\">$VERSION_CODENAME</span><span style=\"color:#9ECBFF\">}\") stable\"</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  sudo</span><span style=\"color:#9ECBFF\"> tee</span><span style=\"color:#9ECBFF\"> /etc/apt/sources.list.d/docker.list</span><span style=\"color:#F97583\"> ></span><span style=\"color:#9ECBFF\"> /dev/null</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Install Docker packages</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> apt-get</span><span style=\"color:#9ECBFF\"> update</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> apt</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#9ECBFF\"> uidmap</span><span style=\"color:#9ECBFF\"> docker-ce</span><span style=\"color:#9ECBFF\"> docker-ce-cli</span><span style=\"color:#9ECBFF\"> containerd.io</span><span style=\"color:#9ECBFF\"> docker-buildx-plugin</span><span style=\"color:#9ECBFF\"> docker-compose-plugin</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Disable root Docker service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> systemctl</span><span style=\"color:#9ECBFF\"> disable</span><span style=\"color:#79B8FF\"> --now</span><span style=\"color:#9ECBFF\"> docker.service</span><span style=\"color:#9ECBFF\"> docker.socket</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> rm</span><span style=\"color:#9ECBFF\"> /var/run/docker.sock</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Create dedicated user for rootless Docker</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> groupadd</span><span style=\"color:#79B8FF\"> --system</span><span style=\"color:#9ECBFF\"> docker</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> useradd</span><span style=\"color:#79B8FF\"> -m</span><span style=\"color:#79B8FF\"> --system</span><span style=\"color:#79B8FF\"> -g</span><span style=\"color:#9ECBFF\"> docker</span><span style=\"color:#E1E4E8\"> $TARGET_USER</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Set up rootless Docker</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">PATH</span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\">/usr/bin:</span><span style=\"color:#E1E4E8\">$PATH</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">/usr/bin/dockerd-rootless-setuptool.sh</span><span style=\"color:#9ECBFF\"> install</span></span></code></pre>\n<h2 id=\"setup-instructions\">Setup Instructions</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># 1. Replace $TARGET_USER with your desired username</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 2. Run the installation script</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">chmod</span><span style=\"color:#9ECBFF\"> +x</span><span style=\"color:#9ECBFF\"> rootless-docker-setup.sh</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">./rootless-docker-setup.sh</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 3. Add environment variables to your shell profile</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">echo</span><span style=\"color:#9ECBFF\"> 'export PATH=/usr/bin:$PATH'</span><span style=\"color:#F97583\"> >></span><span style=\"color:#9ECBFF\"> ~/.bashrc</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">echo</span><span style=\"color:#9ECBFF\"> 'export DOCKER_HOST=unix:///run/user/$(id -u)/docker.sock'</span><span style=\"color:#F97583\"> >></span><span style=\"color:#9ECBFF\"> ~/.bashrc</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">source</span><span style=\"color:#9ECBFF\"> ~/.bashrc</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 4. Start the rootless Docker service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">systemctl</span><span style=\"color:#79B8FF\"> --user</span><span style=\"color:#9ECBFF\"> start</span><span style=\"color:#9ECBFF\"> docker</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">systemctl</span><span style=\"color:#79B8FF\"> --user</span><span style=\"color:#9ECBFF\"> enable</span><span style=\"color:#9ECBFF\"> docker</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 5. Verify installation</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#79B8FF\"> --version</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> hello-world</span></span></code></pre>\n<h2 id=\"service-management\">Service Management</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Start rootless Docker service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">systemctl</span><span style=\"color:#79B8FF\"> --user</span><span style=\"color:#9ECBFF\"> start</span><span style=\"color:#9ECBFF\"> docker</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Stop rootless Docker service</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">systemctl</span><span style=\"color:#79B8FF\"> --user</span><span style=\"color:#9ECBFF\"> stop</span><span style=\"color:#9ECBFF\"> docker</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Check service status</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">systemctl</span><span style=\"color:#79B8FF\"> --user</span><span style=\"color:#9ECBFF\"> status</span><span style=\"color:#9ECBFF\"> docker</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Enable auto-start on boot</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">systemctl</span><span style=\"color:#79B8FF\"> --user</span><span style=\"color:#9ECBFF\"> enable</span><span style=\"color:#9ECBFF\"> docker</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">loginctl</span><span style=\"color:#9ECBFF\"> enable-linger</span><span style=\"color:#E1E4E8\"> $USER</span></span></code></pre>\n<h2 id=\"limitations--considerations\">Limitations &#x26; Considerations</h2>\n<h3 id=\"port-binding-limitations\">Port Binding Limitations</h3>\n<ul>\n<li>Can only bind to ports >= 1024</li>\n<li>Use port forwarding for privileged ports</li>\n</ul>\n<h3 id=\"network-limitations\">Network Limitations</h3>\n<ul>\n<li>Some network drivers may not work</li>\n<li>Host networking is restricted</li>\n</ul>\n<h3 id=\"storage-limitations\">Storage Limitations</h3>\n<ul>\n<li>Some storage drivers may not be available</li>\n<li>FUSE overlayfs is used by default</li>\n</ul>\n<h3 id=\"performance\">Performance</h3>\n<ul>\n<li>Slightly reduced performance due to user namespace</li>\n<li>Additional overhead for system calls</li>\n</ul>\n<h2 id=\"troubleshooting\">Troubleshooting</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Check if rootless mode is active</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> info</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> grep</span><span style=\"color:#79B8FF\"> -i</span><span style=\"color:#9ECBFF\"> rootless</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Check user namespace support</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cat</span><span style=\"color:#9ECBFF\"> /proc/sys/kernel/unprivileged_userns_clone</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Enable user namespaces if disabled</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">echo</span><span style=\"color:#9ECBFF\"> 'kernel.unprivileged_userns_clone=1'</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> sudo</span><span style=\"color:#9ECBFF\"> tee</span><span style=\"color:#79B8FF\"> -a</span><span style=\"color:#9ECBFF\"> /etc/sysctl.conf</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> sysctl</span><span style=\"color:#79B8FF\"> -p</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Fix permission issues</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> setcap</span><span style=\"color:#9ECBFF\"> cap_net_bind_service=ep</span><span style=\"color:#E1E4E8\"> $(</span><span style=\"color:#79B8FF\">which</span><span style=\"color:#9ECBFF\"> rootlesskit</span><span style=\"color:#E1E4E8\">)</span></span></code></pre>\n<h2 id=\"security-benefits\">Security Benefits</h2>\n<ul>\n<li><strong>Reduced attack surface</strong> - No root privileges required</li>\n<li><strong>User namespace isolation</strong> - Enhanced container security</li>\n<li><strong>Container breakout protection</strong> - Limits damage from container escapes</li>\n<li><strong>Better multi-user security</strong> - Each user has isolated Docker instances</li>\n<li><strong>Compliance with security policies</strong> - Meets strict security requirements</li>\n</ul>\n<h2 id=\"port-forwarding-for-privileged-ports\">Port Forwarding for Privileged Ports</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Forward port 80 to 8080 for web applications</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> iptables</span><span style=\"color:#79B8FF\"> -t</span><span style=\"color:#9ECBFF\"> nat</span><span style=\"color:#79B8FF\"> -A</span><span style=\"color:#9ECBFF\"> PREROUTING</span><span style=\"color:#79B8FF\"> -p</span><span style=\"color:#9ECBFF\"> tcp</span><span style=\"color:#79B8FF\"> --dport</span><span style=\"color:#79B8FF\"> 80</span><span style=\"color:#79B8FF\"> -j</span><span style=\"color:#9ECBFF\"> REDIRECT</span><span style=\"color:#79B8FF\"> --to-port</span><span style=\"color:#79B8FF\"> 8080</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Or use socat for simple forwarding</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">socat</span><span style=\"color:#9ECBFF\"> TCP-LISTEN:80,fork</span><span style=\"color:#9ECBFF\"> TCP:localhost:8080</span></span></code></pre>\n<h2 id=\"systemd-user-service\">Systemd User Service</h2>\n<p>Create <code>~/.config/systemd/user/docker.service</code>:</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"ini\"><code><span class=\"line\"><span style=\"color:#B392F0\">[Unit]</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">Description</span><span style=\"color:#E1E4E8\">=Docker Application Container Engine (Rootless)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">Documentation</span><span style=\"color:#E1E4E8\">=https://docs.docker.com</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">[Service]</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">Type</span><span style=\"color:#E1E4E8\">=notify</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">ExecStart</span><span style=\"color:#E1E4E8\">=/usr/bin/dockerd-rootless.sh</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">ExecReload</span><span style=\"color:#E1E4E8\">=/bin/kill -s HUP $MAINPID</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">TimeoutSec</span><span style=\"color:#E1E4E8\">=0</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">RestartSec</span><span style=\"color:#E1E4E8\">=2</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">Restart</span><span style=\"color:#E1E4E8\">=always</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">StartLimitBurst</span><span style=\"color:#E1E4E8\">=3</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">StartLimitInterval</span><span style=\"color:#E1E4E8\">=60s</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">LimitNOFILE</span><span style=\"color:#E1E4E8\">=infinity</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">LimitNPROC</span><span style=\"color:#E1E4E8\">=infinity</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">LimitCORE</span><span style=\"color:#E1E4E8\">=infinity</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">TasksMax</span><span style=\"color:#E1E4E8\">=infinity</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">Delegate</span><span style=\"color:#E1E4E8\">=yes</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">[Install]</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">WantedBy</span><span style=\"color:#E1E4E8\">=default.target</span></span></code></pre>\n<h2 id=\"best-practices\">Best Practices</h2>\n<ul>\n<li>Use rootless mode for development and testing</li>\n<li>Consider rootless for production with proper security review</li>\n<li>Monitor resource usage as rootless has higher overhead</li>\n<li>Use volume mounts instead of bind mounts when possible</li>\n<li>Keep the system updated with security patches</li>\n</ul>\n<h2 id=\"migration-from-root-docker\">Migration from Root Docker</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Stop root Docker</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> systemctl</span><span style=\"color:#9ECBFF\"> stop</span><span style=\"color:#9ECBFF\"> docker</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Export containers and images</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> save</span><span style=\"color:#79B8FF\"> -o</span><span style=\"color:#9ECBFF\"> containers.tar</span><span style=\"color:#E1E4E8\"> $(</span><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> images</span><span style=\"color:#79B8FF\"> -q</span><span style=\"color:#E1E4E8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Start rootless Docker</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">systemctl</span><span style=\"color:#79B8FF\"> --user</span><span style=\"color:#9ECBFF\"> start</span><span style=\"color:#9ECBFF\"> docker</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Import containers and images</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">docker</span><span style=\"color:#9ECBFF\"> load</span><span style=\"color:#79B8FF\"> -i</span><span style=\"color:#9ECBFF\"> containers.tar</span></span></code></pre>"},{"id":"rsync-backup","title":"Using rsync for backup","description":"Simple command to (safely) backup the home directory of a user","category":"utility","content":"<h2 id=\"home-dir-full-backup\">Home Dir full backup</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#B392F0\">sudo</span><span style=\"color:#9ECBFF\"> rsync</span><span style=\"color:#79B8FF\"> -a</span><span style=\"color:#79B8FF\"> --info=progress2</span><span style=\"color:#79B8FF\"> --exclude=</span><span style=\"color:#9ECBFF\">\"lost+found\"</span><span style=\"color:#79B8FF\"> --exclude=</span><span style=\"color:#9ECBFF\">\".cache\"</span><span style=\"color:#79B8FF\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    /home/</span><span style=\"color:#9ECBFF\"> /mnt/usbdrive-name/</span></span></code></pre>\n<h1 id=\"general-incremental-file-transfer\">General incremental file transfer</h1>\n<h2 id=\"local-to-local\">Local to Local:</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#B392F0\">rsync</span><span style=\"color:#E1E4E8\"> [OPTION]... [SRC]... DEST</span></span></code></pre>\n<h2 id=\"local-to-remote\">Local to Remote:</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#B392F0\">rsync</span><span style=\"color:#E1E4E8\"> [OPTION]... [SRC]... [USER@]HOST:DEST</span></span></code></pre>\n<h2 id=\"remote-to-local\">Remote to Local:</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#B392F0\">rsync</span><span style=\"color:#E1E4E8\"> [OPTION]... [USER@]HOST:SRC... [DEST]</span></span></code></pre>"},{"id":"sops-nix-configuration","title":"sops-nix Configuration","description":"Configure sops-nix to save and distribute secrets securely in NixOS","category":"nix","content":"<h1 id=\"sops-nix-configuration\">sops-nix Configuration</h1>\n<p>Modify the existing <code>flake.nix</code> as such:</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"nix\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  inputs</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    nixpkgs</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">url</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"github:NixOS/nixpkgs/nixos-unstable\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    nixd</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">url</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"github:nix-community/nixd/main\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    nixfmt</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">url</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"github:NixOS/nixfmt/master\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    home-manager</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      url</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"github:nix-community/home-manager\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      inputs</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">nixpkgs</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">follows</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"nixpkgs\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    ...</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    sops-nix</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      url</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"github:Mic92/sops-nix\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      inputs</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">nixpkgs</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">follows</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"nixpkgs\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  outputs</span><span style=\"color:#F97583\"> =</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    inputs@{</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      self</span><span style=\"color:#F97583\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      nixpkgs</span><span style=\"color:#F97583\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      home-manager</span><span style=\"color:#F97583\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      sops-nix</span><span style=\"color:#F97583\">,</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      ...</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }:</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    ...</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      nixosConfigurations</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#9ECBFF\">\"nixos\"</span><span style=\"color:#F97583\"> =</span><span style=\"color:#FFAB70\"> nixpkgs</span><span style=\"color:#F97583\">.</span><span style=\"color:#FFAB70\">lib</span><span style=\"color:#F97583\">.</span><span style=\"color:#FFAB70\">nixosSystem</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        ...</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      }</span><span style=\"color:#FDAEB7;font-style:italic\">;</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">      ...</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">      sops-nix.nixosModules.sops</span></span></code></pre>\n<p>Then, generate age key pair (recommended over GPG)</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#B392F0\">nix-shell</span><span style=\"color:#79B8FF\"> -p</span><span style=\"color:#9ECBFF\"> age</span><span style=\"color:#79B8FF\"> --run</span><span style=\"color:#9ECBFF\"> \"age-keygen -o ~/.config/sops/age/keys.txt\"</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cat</span><span style=\"color:#9ECBFF\"> ~/.config/sops/age/keys.txt</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> grep</span><span style=\"color:#9ECBFF\"> \"public key:\"</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> cut</span><span style=\"color:#79B8FF\"> -d:</span><span style=\"color:#79B8FF\"> -f2</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> xargs</span></span></code></pre>\n<p>The second command should print the generated public key, which we will store in <code>/etc/nixos/.sops.yaml</code>:</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"nix\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">creation_rules:</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  -</span><span style=\"color:#E1E4E8\"> path_regex: </span><span style=\"color:#9ECBFF\">secrets/.</span><span style=\"color:#F97583\">*</span><span style=\"color:#FDAEB7;font-style:italic\">\\</span><span style=\"color:#F97583\">.</span><span style=\"color:#FFAB70\">yaml</span><span style=\"color:#FDAEB7;font-style:italic\">$</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    key_groups:</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      -</span><span style=\"color:#E1E4E8\"> age:</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">          -</span><span style=\"color:#9ECBFF\"> \"PUBLIC_KEY\"</span></span></code></pre>\n<p>Next, we create the unencrypted file in <code>/etc/nixos/secrets.yaml</code>:</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"yaml\"><code><span class=\"line\"><span style=\"color:#85E89D\">KEY_1</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">VALUE</span></span>\n<span class=\"line\"><span style=\"color:#85E89D\">KEY_2</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">ANOTHER_VALUE</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">...</span><span style=\"color:#79B8FF\">.</span></span></code></pre>\n<p>Which we encrypt with:</p>\n<p><code>nix-shell -p sops --run \"sops --config /etc/nixos/secrets.yaml --encrypt --in-place /etc/nixos/secrets/secrets-enc.yaml\"</code></p>\n<p><em><strong>IMPORTANT NOTE:</strong></em> NEVER forget to keep a <code>.gitignore</code> here, and to update it with the name of the <code>secrets.yaml</code> file, since it will contain all the unencrypted secrets.</p>\n<p>After this, we create the file <code>/etc/nixos/sops.nix</code>:</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"nix\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  sops</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    defaultSopsFile</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> ./secrets/secrets.yaml</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    age</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">keyFile</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"/home/hytx/.config/sops/age/keys.txt\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    secrets</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      deepseekAPIKey</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        mode</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"0400\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"root\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        group</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"root\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        path</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"/run/secrets/deepseek-api-key\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      };</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      xSTFCTFDToken</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        mode</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"0400\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"root\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        group</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"root\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        path</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"/run/secrets/ctfd-token\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      };</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      xSTFCTFDURL</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        mode</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"0400\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"root\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        group</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"root\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        path</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"/run/secrets/ctfd-url\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      };</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      xSTFCTFDDeployHost</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        mode</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"0400\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"root\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        group</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"root\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        path</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"/run/secrets/ctfd-deploy-host\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      };</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      INESCTECVPNConfig</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        mode</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"0400\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        owner</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"root\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        group</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"root\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        path</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"/etc/openvpn/inesctec.conf\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        sopsFile</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> ./secrets/secrets.yaml</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>\n<p>And import it in <code>configuration.nix</code>:</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"nix\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{ </span><span style=\"color:#F97583\">... </span><span style=\"color:#E1E4E8\">}:</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  imports</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> [</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    ./hardware-configuration.nix</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    ...</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    ./sops.nix</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  ];</span></span></code></pre>\n<p>The secrets will be created in <code>/run/secrets/KEY_NAME</code>, with this configuration, being read-only only by root.</p>\n<h2 id=\"secret-usage-in-nix-configuration-files\">Secret usage in Nix configuration files</h2>\n<p>Since the secrets are stored in <code>/run</code>, we need to access them out-of-band, outside of the evaluation time when rebuilding the system.</p>\n<p>The way we do this is, instead of realizing the actual path on rebuild, we set environment variables to read from the key paths:</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"nix\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">{ </span><span style=\"color:#F97583\">... </span><span style=\"color:#E1E4E8\">}:</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">{</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  environment</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    ...</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">    shellInit</span><span style=\"color:#FDAEB7;font-style:italic\"> =</span><span style=\"color:#FDAEB7;font-style:italic\"> ''</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">      ...</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">      if</span><span style=\"color:#FDAEB7;font-style:italic\"> [</span><span style=\"color:#FDAEB7;font-style:italic\"> -f</span><span style=\"color:#FDAEB7;font-style:italic\"> /run/secrets/KEY_1</span><span style=\"color:#FDAEB7;font-style:italic\"> ];</span><span style=\"color:#FDAEB7;font-style:italic\"> then</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">        export</span><span style=\"color:#FDAEB7;font-style:italic\"> KEY_1=\"$(cat</span><span style=\"color:#FDAEB7;font-style:italic\"> /run/secrets/KEY_1)\"</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">      fi</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">      if</span><span style=\"color:#FDAEB7;font-style:italic\"> [</span><span style=\"color:#FDAEB7;font-style:italic\"> -f</span><span style=\"color:#FDAEB7;font-style:italic\"> /run/secrets/KEY_2</span><span style=\"color:#FDAEB7;font-style:italic\"> ];</span><span style=\"color:#FDAEB7;font-style:italic\"> then</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">        export</span><span style=\"color:#FDAEB7;font-style:italic\"> KEY_2=\"$(cat</span><span style=\"color:#FDAEB7;font-style:italic\"> /run/secrets/KEY_2)\"</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">      fi</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">      ...</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">    '';</span></span>\n<span class=\"line\"><span style=\"color:#FDAEB7;font-style:italic\">    ...</span></span></code></pre>\n<h2 id=\"updating-secrets\">Updating secrets</h2>\n<p>Simply use <code>nix-shell -p sops --run \"sops /etc/nixos/secrets/secrets.yaml\"</code> to live edit the secrets, do not forget to include/exclude them from the <code>sops.nix</code> file, or the rebuild will fail.</p>"},{"id":"utility-belt","title":"Utility Belt","description":"Main utilities hub with overview of all available utilities","category":"general","content":"<h1 id=\"utility-belt\">Utility Belt</h1>\n<p>n- iffy, uh, blicky got the stiffy, uh\nGot the blicky, uh, drum, it hold fifty, uh</p>\n<h2 id=\"available-utilities\">Available Utilities</h2>\n<h3 id=\"system-utilities\">System Utilities</h3>\n<ul>\n<li><strong>proxmox-lxc-boot</strong> - Initial boot for Proxmox LXC containers</li>\n<li><strong>docker-install</strong> - Complete Docker installation script</li>\n<li><strong>rootless-docker</strong> - Secure rootless Docker setup</li>\n</ul>\n<h3 id=\"security--networking\">Security &#x26; Networking</h3>\n<ul>\n<li><strong>certificate-generation</strong> - SSL certificate generation with Certbot</li>\n</ul>\n<h2 id=\"navigation-commands\">Navigation Commands</h2>\n<p>Use the terminal commands to navigate and access utilities:</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\"><code><span class=\"line\"><span style=\"color:#6A737D\"># List available directories</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">ls</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Navigate to utilities</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">cd</span><span style=\"color:#9ECBFF\"> utilities</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># List utilities</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">ls</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Open a utility</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">cat</span><span style=\"color:#9ECBFF\"> utility-name</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Get help</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">help</span></span></code></pre>\n<h2 id=\"quick-access\">Quick Access</h2>\n<ul>\n<li><strong>ESC</strong> - Toggle terminal input focus</li>\n<li><strong>Backspace</strong> - Go back from utility view</li>\n<li><strong>Arrow keys</strong> - Navigate directory items</li>\n<li><strong>Enter</strong> - Select/activate items</li>\n</ul>\n<p>All utilities are designed to be practical, production-ready scripts that can be used directly in your projects.</p>"}];
			window.fileSystem = {"github-projects":{"bloccChainz":{"type":"project","url":"https://github.com/rootHytx/bloccChainz"},"github":{"type":"project","url":"https://github.com/rootHytx"},"sistemas-embutidos":{"type":"project","url":"https://github.com/rootHytx/sistemas-embutidos"},"trabalho-redes":{"type":"project","url":"https://github.com/rootHytx/trabalho-redes"}},"utilities":{"certificate-generation":{"type":"utility","url":"certificate-generation"},"docker-install":{"type":"utility","url":"docker-install"},"proxmox-lxc-boot":{"type":"utility","url":"proxmox-lxc-boot"},"rootless-docker":{"type":"utility","url":"rootless-docker"},"rsync-backup":{"type":"utility","url":"rsync-backup"},"sops-nix-configuration":{"type":"utility","url":"sops-nix-configuration"},"utility-belt":{"type":"utility","url":"utility-belt"}}};
			</script> </body> </html>